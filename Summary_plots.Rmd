---
title: "R scripts for summary plots across surveys"
author: Guoqiang Zhang
email: guoqiang.zhang@ki.se
output: html_notebook
editor_options: 
  chunk_output_type: console
---

### 1. Load Packages
```{r}
library(forestploter)
library(grid)
library(readxl)
library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(ggbreak)
library(naniar)
```

### 2. Plots for Proportion of Sexual Identity
#### 2.1. Complete-case analysis
##### 2.1.1. Prepare dataset for plotting
```{r}
# datasets for proportion of sexual identity
prop_cc_summary_2010 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_cc_summary_2010.xlsx")
prop_cc_summary_2014 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_cc_summary_2014.xlsx")
prop_cc_summary_2021 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_cc_summary_2021.xlsx")

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
prop_cc_summary_2010$subgroup[ prop_cc_summary_2010$subgroup == "18-29" ] <- "16-29"
prop_cc_summary_2010$subgroup[ prop_cc_summary_2010$subgroup == "18-29.Male" ] <- "16-29.Male"
prop_cc_summary_2010$subgroup[ prop_cc_summary_2010$subgroup == "18-29.Female" ] <- "16-29.Female"

# merge datasets
prop_cc_summary <- prop_cc_summary_2010 %>%
  full_join( prop_cc_summary_2014, by = "subgroup" ) %>%
  full_join( prop_cc_summary_2021, by = "subgroup" )

# modify table format
desired_order <- c( "Male", "Female", "16-29", "30-44", "45-59", ">=60", "16-29.Male", "30-44.Male", "45-59.Male", ">=60.Male", "16-29.Female", "30-44.Female", "45-59.Female", ">=60.Female", "Sweden", "Europe", "Outside Europe", "<=9 years", "10-12 years", ">=13 years", "Manual and field trades", "Service and support", "Expertise and leadership", "<=2,500", "(2,500, 3,500]", "(3,500, 4,500]", ">4,500", "Currently married", "Never married", "Other", "living_alone_yes", "living_alone_no", "personal_support_yes", "personal_support_no", "Stockholm County" )

prop_cc_summary <- prop_cc_summary %>%
  mutate( subgroup = factor( subgroup, levels = desired_order ) ) %>%
  arrange( subgroup )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Sex", .before = 1 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Age group", .before = 4 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Age by sex", .before = 9 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Country of birth", .before = 18 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Education years", .before = 22 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Occupationᵈ", .before = 26 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Income (100 kr/yr)ᵉ", .before = 30 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Marital statusᶠ", .before = 35 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Living alone", .before = 39 )

prop_cc_summary <- prop_cc_summary %>% 
  add_row( subgroup = "Personal support", .before = 42 )

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "16-29" ] <- "16–29 yrsᵇ"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "30-44" ] <- "30–44 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "45-59" ] <- "45–59 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=60" ] <- "\u2265 60 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "16-29.Male" ] <- "Male: 16–29 yrsᵇ"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "30-44.Male" ] <- "Male: 30–44 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "45-59.Male" ] <- "Male: 45–59 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=60.Male" ] <- "Male: \u2265 60 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "16-29.Female" ] <- "Female: 16–29 yrsᵇ"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "30-44.Female" ] <- "Female: 30–44 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "45-59.Female" ] <- "Female: 45–59 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=60.Female" ] <- "Female: \u2265 60 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "<=9 years" ] <- "\u2264 9 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "10-12 years" ] <- "10–12 yrs"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">=13 years" ] <- "\u2265 13 yrs"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "Europe" ] <- "Europeᶜ"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "<=2,500" ] <- "\u2264 2,500"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == ">4,500" ] <- "> 4,500"

prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "living_alone_no" ] <- "No"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "living_alone_yes" ] <- "Yes"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "personal_support_no" ] <- "No"
prop_cc_summary$subgroup[ prop_cc_summary$subgroup == "personal_support_yes" ] <- "Yes"

prop_cc_summary$subgroup <- ifelse( is.na( prop_cc_summary$Heterosexual_point_estimate_2010 ) | 
                                      prop_cc_summary$subgroup == "Stockholm County", 
                                    prop_cc_summary$subgroup,
                                    paste0( "   ", prop_cc_summary$subgroup ) )

colnames( prop_cc_summary )[ colnames( prop_cc_summary ) == "subgroup" ] <- "Subgroup"

prop_cc_summary$sample_size_2010 <- ifelse( is.na( prop_cc_summary$sample_size_2010 ), "",
                                            prop_cc_summary$sample_size_2010 )

prop_cc_summary$sample_size_2014 <- ifelse( is.na( prop_cc_summary$sample_size_2014 ), "",
                                            prop_cc_summary$sample_size_2014 )

prop_cc_summary$sample_size_2021 <- ifelse( is.na( prop_cc_summary$sample_size_2021 ) &
                                              is.na( prop_cc_summary$Heterosexual_point_estimate_2010 ), "",
                                            ifelse( is.na( prop_cc_summary$sample_size_2021 ),  "\u2013",
                                                    prop_cc_summary$sample_size_2021 ) )
```

##### 2.1.2. Heterosexual group
```{r}
prop_cc_summary_heterosexual <- prop_cc_summary[ -c( 9:17 ), c( 1:4, 14:17, 27:30, 40 ) ]
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )
  
prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>% 
  add_column( "SPHC-B 2021" = paste0(
  sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021*100 ), " (", 
  sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_lower_ci_2021*100 ), ", ", 
  sprintf( "%.1f", prop_cc_summary_heterosexual$Heterosexual_upper_ci_2021*100 ), ")"  ),
  .before = 15 )

prop_cc_summary_heterosexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010 ), "",
  prop_cc_summary_heterosexual$`SPHC-B 2010` )

prop_cc_summary_heterosexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2014 ), "",
  prop_cc_summary_heterosexual$`SPHC-B 2014` )

prop_cc_summary_heterosexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010 ) &
    is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021 ), "\u2013",
          prop_cc_summary_heterosexual$`SPHC-B 2021` ) )

prop_cc_summary_heterosexual <- prop_cc_summary_heterosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_heterosexual )[ names( prop_cc_summary_heterosexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_heterosexual )[ colnames( prop_cc_summary_heterosexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
  )
  
p_cc_heterosexual <- forest(
  prop_cc_summary_heterosexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
    
  est = list( prop_cc_summary_heterosexual$Heterosexual_point_estimate_2010*100,
              prop_cc_summary_heterosexual$Heterosexual_point_estimate_2014*100,
              prop_cc_summary_heterosexual$Heterosexual_point_estimate_2021*100
              ),
  
  lower = list( prop_cc_summary_heterosexual$Heterosexual_lower_ci_2010*100,
                prop_cc_summary_heterosexual$Heterosexual_lower_ci_2014*100,
                prop_cc_summary_heterosexual$Heterosexual_lower_ci_2021*100
                ),
  
  upper = list( prop_cc_summary_heterosexual$Heterosexual_upper_ci_2010*100,
                prop_cc_summary_heterosexual$Heterosexual_upper_ci_2014*100,
                prop_cc_summary_heterosexual$Heterosexual_upper_ci_2021*100
                ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_heterosexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
                prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2014*100,
                prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2021*100 ),
  
  vert_line = prop_cc_summary_heterosexual[ prop_cc_summary_heterosexual$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
    
  xlim = list( c( 90, 100 ), c( 60, 100 ), c( 60, 100 ) ),
  ticks_at = list( c( 90, 95, 100 ), c( 60, 80, 100 ), c( 60, 80, 100 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
  )

p_cc_heterosexual <- edit_plot(
  p_cc_heterosexual,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- insert_text(
  p_cc_heterosexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_text(
  p_cc_heterosexual,
  text = "Heterosexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_heterosexual <- add_border(
  p_cc_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_heterosexual <- add_border(
  p_cc_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_heterosexual <- add_border(
  p_cc_heterosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_heterosexual <- edit_plot( p_cc_heterosexual,
                                row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                                which = "background",
                                gp = gpar( fill = "white" )
                                )

p_cc_heterosexual <- edit_plot( p_cc_heterosexual,
                                row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                                which = "background",
                                gp = gpar( fill = "#eff3f2" )
                                )
 
plot( p_cc_heterosexual )
```

##### 2.1.3. Homosexual group
```{r}
prop_cc_summary_homosexual <- prop_cc_summary[ -c( 9:17 ), c( 1, 5:7, 14, 18:20, 27, 31:33, 40 ) ]

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_homosexual$Homosexual_upper_ci_2021*100 ), ")"  ),
    .before = 15 )

prop_cc_summary_homosexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2010 ), "",
  prop_cc_summary_homosexual$`SPHC-B 2010` )

prop_cc_summary_homosexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2014 ), "",
  prop_cc_summary_homosexual$`SPHC-B 2014` )

prop_cc_summary_homosexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2010 ) &
    is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_cc_summary_homosexual$Homosexual_point_estimate_2021 ), "\u2013",
          prop_cc_summary_homosexual$`SPHC-B 2021` ) )

prop_cc_summary_homosexual <- prop_cc_summary_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_homosexual )[ names( prop_cc_summary_homosexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_homosexual )[ colnames( prop_cc_summary_homosexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_cc_homosexual <- forest(
  prop_cc_summary_homosexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_cc_summary_homosexual$Homosexual_point_estimate_2010*100,
              prop_cc_summary_homosexual$Homosexual_point_estimate_2014*100,
              prop_cc_summary_homosexual$Homosexual_point_estimate_2021*100
  ),
  
  lower = list( prop_cc_summary_homosexual$Homosexual_lower_ci_2010*100,
                prop_cc_summary_homosexual$Homosexual_lower_ci_2014*100,
                prop_cc_summary_homosexual$Homosexual_lower_ci_2021*100
  ),
  
  upper = list( prop_cc_summary_homosexual$Homosexual_upper_ci_2010*100,
                prop_cc_summary_homosexual$Homosexual_upper_ci_2014*100,
                prop_cc_summary_homosexual$Homosexual_upper_ci_2021*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_homosexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
                prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2014*100,
                prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2021*100 ),
  
  vert_line = prop_cc_summary_homosexual[ prop_cc_summary_homosexual$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
  
  xlim = list( c( 0, 4 ), c( 0, 4 ), c( 0, 4 ) ),
  ticks_at = list( c( 0, 1, 2, 3, 4 ), c( 0, 1, 2, 3, 4 ), c( 0, 1, 2, 3, 4 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_cc_homosexual <- edit_plot(
  p_cc_homosexual,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- insert_text(
  p_cc_homosexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_text(
  p_cc_homosexual,
  text = "Homosexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_homosexual <- add_border(
  p_cc_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_homosexual <- add_border(
  p_cc_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_homosexual <- add_border(
  p_cc_homosexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_homosexual <- edit_plot( p_cc_homosexual,
                              row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                              which = "background",
                              gp = gpar( fill = "white" )
                              )

p_cc_homosexual <- edit_plot( p_cc_homosexual,
                              row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                              which = "background",
                              gp = gpar( fill = "#eff3f2" )
                              )

plot( p_cc_homosexual )
```

##### 2.1.4. Bisexual group
```{r}
prop_cc_summary_bisexual <- prop_cc_summary[ -c( 9:17 ), c( 1, 8:10, 14, 21:23, 27, 34:36, 40 ) ]

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_upper_ci_2014*100 ), ")" ),
    .before = 9 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_bisexual$Bisexual_upper_ci_2021*100 ), ")"  ),
    .before = 15 )

prop_cc_summary_bisexual$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2010 ), "",
  prop_cc_summary_bisexual$`SPHC-B 2010` )

prop_cc_summary_bisexual$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2014 ), "",
  prop_cc_summary_bisexual$`SPHC-B 2014` )

prop_cc_summary_bisexual$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2010 ) &
    is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2021 ), "",
  ifelse( is.na( prop_cc_summary_bisexual$Bisexual_point_estimate_2021 ), "\u2013",
          prop_cc_summary_bisexual$`SPHC-B 2021` ) )

prop_cc_summary_bisexual <- prop_cc_summary_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_bisexual )[ names( prop_cc_summary_bisexual ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_bisexual )[ colnames( prop_cc_summary_bisexual ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_cc_bisexual <- forest(
  prop_cc_summary_bisexual[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_cc_summary_bisexual$Bisexual_point_estimate_2010*100,
              prop_cc_summary_bisexual$Bisexual_point_estimate_2014*100,
              prop_cc_summary_bisexual$Bisexual_point_estimate_2021*100
  ),
  
  lower = list( prop_cc_summary_bisexual$Bisexual_lower_ci_2010*100,
                prop_cc_summary_bisexual$Bisexual_lower_ci_2014*100,
                prop_cc_summary_bisexual$Bisexual_lower_ci_2021*100
  ),
  
  upper = list( prop_cc_summary_bisexual$Bisexual_upper_ci_2010*100,
                prop_cc_summary_bisexual$Bisexual_upper_ci_2014*100,
                prop_cc_summary_bisexual$Bisexual_upper_ci_2021*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_bisexual ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
                prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2014*100,
                prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2021*100 ),
  
  vert_line = prop_cc_summary_bisexual[ prop_cc_summary_bisexual$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
  
  xlim = list( c( 0, 5 ), c( 0, 10 ), c( 0, 10 ) ),
  ticks_at = list( c( 0, 1, 2, 3, 4, 5 ), c( 0, 2, 4, 6, 8, 10 ), c( 0, 2, 4, 6, 8, 10 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_cc_bisexual <- edit_plot(
  p_cc_bisexual,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- insert_text(
  p_cc_bisexual,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_text(
  p_cc_bisexual,
  text = "Bisexual, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_bisexual <- add_border(
  p_cc_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_bisexual <- add_border(
  p_cc_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_bisexual <- add_border(
  p_cc_bisexual,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_bisexual <- edit_plot( p_cc_bisexual,
                            row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                            which = "background",
                            gp = gpar( fill = "white" )
                            )

p_cc_bisexual <- edit_plot( p_cc_bisexual,
                            row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                            which = "background",
                            gp = gpar( fill = "#eff3f2" )
                            )

plot( p_cc_bisexual )
```

##### 2.1.5. Other group
```{r}
prop_cc_summary_other <- prop_cc_summary[ -c( 9:17 ), c( 1, 11:13, 14, 24:26, 27, 37:39, 40 ) ]

prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "   16–29 yrsᵇ" ] <- "   16–29 yrsᶜ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "   Europeᶜ" ] <- "   Europeᵈ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "Occupationᵈ" ] <- "Occupationᵉ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "Income (100 kr/yr)ᵉ" ] <- "Income (100 kr/yr)ᶠ"
prop_cc_summary_other$Subgroup[ prop_cc_summary_other$Subgroup == "Marital statusᶠ" ] <- "Marital statusᵍ"

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( "SPHC-B 2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_other$Uncertain_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_other$Uncertain_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_other$Uncertain_upper_ci_2010*100 ), ")" ),
    .before = 3 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( "SPHC-B 2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_point_estimate_2014`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_lower_ci_2014`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_upper_ci_2014`*100 ), ")" ),
    .before = 9 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

prop_cc_summary_other <- prop_cc_summary_other %>% 
  add_column( "SPHC-B 2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_point_estimate_2021`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_lower_ci_2021`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_other$`None of the above_upper_ci_2021`*100 ), ")"  ),
    .before = 15 )

prop_cc_summary_other$`SPHC-B 2010` <- ifelse( 
  is.na( prop_cc_summary_other$Uncertain_point_estimate_2010 ), "",
  prop_cc_summary_other$`SPHC-B 2010` )

prop_cc_summary_other$`SPHC-B 2014` <- ifelse( 
  is.na( prop_cc_summary_other$`None of the above_point_estimate_2014` ), "",
  prop_cc_summary_other$`SPHC-B 2014` )

prop_cc_summary_other$`SPHC-B 2021` <- ifelse( 
  is.na( prop_cc_summary_other$Uncertain_point_estimate_2010 ) &
    is.na( prop_cc_summary_other$`None of the above_point_estimate_2021` ), "",
  ifelse( is.na( prop_cc_summary_other$`None of the above_point_estimate_2021` ), "\u2013",
          prop_cc_summary_other$`SPHC-B 2021` ) )

prop_cc_summary_other <- prop_cc_summary_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 8 ) %>%
  add_column( temp3 = " ", .before = 10 ) %>%
  add_column( temp4 = " ", .before = 16 ) %>%
  add_column( temp5 = " ", .before = 18 ) %>%
  add_column( temp6 = " ", .before = 24 )

names( prop_cc_summary_other )[ names( prop_cc_summary_other ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "SPHC-B 2010" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "SPHC-B 2014" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "SPHC-B 2021" ] <- ""

colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "sample_size_2010" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "sample_size_2014" ] <- ""
colnames( prop_cc_summary_other )[ colnames( prop_cc_summary_other ) == "sample_size_2021" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

p_cc_other <- forest(
  prop_cc_summary_other[ , c( 1:4, 8:12, 16:20, 24, 25 ) ],
  
  est = list( prop_cc_summary_other$Uncertain_point_estimate_2010*100,
              prop_cc_summary_other$`None of the above_point_estimate_2014`*100,
              prop_cc_summary_other$`None of the above_point_estimate_2021`*100
  ),
  
  lower = list( prop_cc_summary_other$Uncertain_lower_ci_2010*100,
                prop_cc_summary_other$`None of the above_lower_ci_2014`*100,
                prop_cc_summary_other$`None of the above_lower_ci_2021`*100
  ),
  
  upper = list( prop_cc_summary_other$Uncertain_upper_ci_2010*100,
                prop_cc_summary_other$`None of the above_upper_ci_2014`*100,
                prop_cc_summary_other$`None of the above_upper_ci_2021`*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( prop_cc_summary_other ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$Uncertain_point_estimate_2010*100,
                prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$`None of the above_point_estimate_2014`*100,
                prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$`None of the above_point_estimate_2021`*100 ),
  
  vert_line = prop_cc_summary_other[ prop_cc_summary_other$Subgroup == "Stockholm County", ]$Uncertain_point_estimate_2010*100,
  
  xlim = list( c( 0, 6 ), c( 0, 30 ), c( 0, 30 ) ),
  ticks_at = list( c( 0, 3, 6 ), c( 0, 5, 10, 15, 20, 25, 30 ), c( 0, 5, 10, 15, 20, 25, 30 ) ),
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_cc_other <- edit_plot(
  p_cc_other,
  row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ),
  gp = gpar(fontface = "bold")
)

p_cc_other <- add_text(
  p_cc_other,
  text = "Uncertain, Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- insert_text(
  p_cc_other,
  text = "SPHC-B 2010",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SPHC-B 2014",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "Otherᵇ, Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "SPHC-B 2021",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_text(
  p_cc_other,
  text = "Otherᵇ, Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_other <- add_border(
  p_cc_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_cc_other <- add_border(
  p_cc_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_cc_other <- add_border(
  p_cc_other,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_cc_other <- edit_plot( p_cc_other,
                         row = c( 1, 4, 9, 13, 17, 21, 26, 30, 33, 36 ), 
                         which = "background",
                         gp = gpar( fill = "white" )
                         )

p_cc_other <- edit_plot( p_cc_other,
                         row = c( 2:3, 5:8, 10:12, 14:16, 18:20, 22:25, 27:29, 31, 32, 34, 35 ), 
                         which = "background",
                         gp = gpar( fill = "#eff3f2" )
                         )

plot( p_cc_other )
```

##### 2.1.6. Age by sex
```{r}
prop_cc_summary_age_sex <- prop_cc_summary[ c( 10:17 ), ]

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_row( Subgroup = "Male", .before = 1 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_row( Subgroup = "Female", .before = 6 )

prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: 16–29 yrsᵇ" ] <- "   16–29 yrsᶜ\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: 30–44 yrs" ] <- "   30–44 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: 45–59 yrs" ] <- "   45–59 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Male: \u2265 60 yrs" ] <- "   \u2265 60 yrs\n\n"

prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: 16–29 yrsᵇ" ] <- "   16–29 yrsᶜ\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: 30–44 yrs" ] <- "   30–44 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: 45–59 yrs" ] <- "   45–59 yrs\n\n"
prop_cc_summary_age_sex$Subgroup[ prop_cc_summary_age_sex$Subgroup == "   Female: \u2265 60 yrs" ] <- "   \u2265 60 yrs\n\n"

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_upper_ci_2010*100 ), ")" ),
    .before = 2 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_upper_ci_2010*100 ), ")" ),
    .before = 6 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_upper_ci_2010*100 ), ")" ),
    .before = 10 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Other_2010" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Uncertain_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Uncertain_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Uncertain_upper_ci_2010*100 ), ")" ),
    .before = 14 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_upper_ci_2014*100 ), ")" ),
    .before = 19 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_upper_ci_2014*100 ), ")" ),
    .before = 23 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_upper_ci_2014*100 ), ")" ),
    .before = 27 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Other_2014" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_point_estimate_2014`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_lower_ci_2014`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_upper_ci_2014`*100 ), ")" ),
    .before = 31 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Heterosexual_upper_ci_2021*100 ), ")" ),
    .before = 36 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Homosexual_upper_ci_2021*100 ), ")" ),
    .before = 40 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_point_estimate_2021*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_lower_ci_2021*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$Bisexual_upper_ci_2021*100 ), ")" ),
    .before = 44 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Other_2021" = paste0(
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_point_estimate_2021`*100 ), " (", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_lower_ci_2021`*100 ), ", ", 
    sprintf( "%.1f", prop_cc_summary_age_sex$`None of the above_upper_ci_2021`*100 ), ")" ),
    .before = 48 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Heterosexual" = paste( prop_cc_summary_age_sex$`Heterosexual_2010`,
                                      prop_cc_summary_age_sex$`Heterosexual_2014`,
                                      prop_cc_summary_age_sex$`Heterosexual_2021`,
                                      sep = "\n" ),
              .before = 2 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Homosexual" = paste( prop_cc_summary_age_sex$`Homosexual_2010`,
                                    prop_cc_summary_age_sex$`Homosexual_2014`,
                                    prop_cc_summary_age_sex$`Homosexual_2021`,
                                    sep = "\n" ),
              .before = 3 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Bisexual" = paste( prop_cc_summary_age_sex$`Bisexual_2010`,
                                  prop_cc_summary_age_sex$`Bisexual_2014`,
                                  prop_cc_summary_age_sex$`Bisexual_2021`,
                                  sep = "\n" ),
              .before = 4 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Otherᵇ" = paste( prop_cc_summary_age_sex$`Other_2010`,
                                prop_cc_summary_age_sex$`Other_2014`,
                                prop_cc_summary_age_sex$`Other_2021`,
                                sep = "\n" ),
              .before = 5 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( "Nᵃ" = paste( prop_cc_summary_age_sex$sample_size_2010,
                            prop_cc_summary_age_sex$sample_size_2014,
                            prop_cc_summary_age_sex$sample_size_2021,
                            sep = "\n" ),
              .before = 2 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 3 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 5 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 7 )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>% 
  add_column( `    ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 9 )

prop_cc_summary_age_sex$`Nᵃ` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                      prop_cc_summary_age_sex$`Nᵃ` )

prop_cc_summary_age_sex$`Heterosexual` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                   prop_cc_summary_age_sex$`Heterosexual` )

prop_cc_summary_age_sex$`Homosexual` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                 prop_cc_summary_age_sex$`Homosexual` )

prop_cc_summary_age_sex$`Bisexual` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                               prop_cc_summary_age_sex$`Bisexual` )

prop_cc_summary_age_sex$`Otherᵇ` <- ifelse( is.na( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010 ), "",
                                                   prop_cc_summary_age_sex$`Otherᵇ` )

prop_cc_summary_age_sex <- prop_cc_summary_age_sex %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 4 ) %>%
  add_column( temp3 = " ", .before = 7 ) %>%
  add_column( temp4 = " ", .before = 10 ) %>%
  add_column( temp5 = " ", .before = 13 )

names( prop_cc_summary_age_sex )[ names( prop_cc_summary_age_sex ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5" ) ] <- ""

colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Nᵃ" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Heterosexual" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Homosexual" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Bisexual" ] <- ""
colnames( prop_cc_summary_age_sex )[ colnames( prop_cc_summary_age_sex ) == "Otherᵇ" ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "#DF536B",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = c( "#2297E6", "#61D04F" )
  )

p_cc_age_sex <- forest(
  prop_cc_summary_age_sex[ , 1:15 ],
  
  est = list( prop_cc_summary_age_sex$Heterosexual_point_estimate_2010*100,
              prop_cc_summary_age_sex$Homosexual_point_estimate_2010*100,
              prop_cc_summary_age_sex$Bisexual_point_estimate_2010*100,
              prop_cc_summary_age_sex$Uncertain_point_estimate_2010*100,
              prop_cc_summary_age_sex$Heterosexual_point_estimate_2014*100,
              prop_cc_summary_age_sex$Homosexual_point_estimate_2014*100,
              prop_cc_summary_age_sex$Bisexual_point_estimate_2014*100,
              prop_cc_summary_age_sex$`None of the above_point_estimate_2014`*100,
              prop_cc_summary_age_sex$Heterosexual_point_estimate_2021*100,
              prop_cc_summary_age_sex$Homosexual_point_estimate_2021*100,
              prop_cc_summary_age_sex$Bisexual_point_estimate_2021*100,
              prop_cc_summary_age_sex$`None of the above_point_estimate_2021`*100
              ),
  
  lower = list( prop_cc_summary_age_sex$Heterosexual_lower_ci_2010*100,
                prop_cc_summary_age_sex$Homosexual_lower_ci_2010*100,
                prop_cc_summary_age_sex$Bisexual_lower_ci_2010*100,
                prop_cc_summary_age_sex$Uncertain_lower_ci_2010*100,
                prop_cc_summary_age_sex$Heterosexual_lower_ci_2014*100,
                prop_cc_summary_age_sex$Homosexual_lower_ci_2014*100,
                prop_cc_summary_age_sex$Bisexual_lower_ci_2014*100,
                prop_cc_summary_age_sex$`None of the above_lower_ci_2014`*100,
                prop_cc_summary_age_sex$Heterosexual_lower_ci_2021*100,
                prop_cc_summary_age_sex$Homosexual_lower_ci_2021*100,
                prop_cc_summary_age_sex$Bisexual_lower_ci_2021*100,
                prop_cc_summary_age_sex$`None of the above_lower_ci_2021`*100
                ),
  
  upper = list( prop_cc_summary_age_sex$Heterosexual_upper_ci_2010*100,
                prop_cc_summary_age_sex$Homosexual_upper_ci_2010*100,
                prop_cc_summary_age_sex$Bisexual_upper_ci_2010*100,
                prop_cc_summary_age_sex$Uncertain_upper_ci_2010*100,
                prop_cc_summary_age_sex$Heterosexual_upper_ci_2014*100,
                prop_cc_summary_age_sex$Homosexual_upper_ci_2014*100,
                prop_cc_summary_age_sex$Bisexual_upper_ci_2014*100,
                prop_cc_summary_age_sex$`None of the above_upper_ci_2014`*100,
                prop_cc_summary_age_sex$Heterosexual_upper_ci_2021*100,
                prop_cc_summary_age_sex$Homosexual_upper_ci_2021*100,
                prop_cc_summary_age_sex$Bisexual_upper_ci_2021*100,
                prop_cc_summary_age_sex$`None of the above_upper_ci_2021`*100
                ),
  
  ci_column = c( 5, 8, 11, 14 ),
  sizes = 0.4,
  
  ref_line = c( 
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Heterosexual_point_estimate_2010*100,
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Homosexual_point_estimate_2010*100,
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Bisexual_point_estimate_2010*100,
    prop_cc_summary[ prop_cc_summary$Subgroup == "Stockholm County", ]$Uncertain_point_estimate_2010*100
    ),
  
  xlim = list( c( 70, 100 ), c( 0, 5 ), c( 0, 15 ), c( 0, 15 ) ),
  ticks_at = list( c( 70, 80, 90, 100 ), c( 0, 1, 2, 3, 4, 5 ), c( 0, 5, 10, 15 ), c( 0, 5, 10, 15 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  nudge_y = 0.33,
  theme = tm
 )

p_cc_age_sex <- edit_plot(p_cc_age_sex,
                          row = c(1, 6),
                          gp = gpar(fontface = "bold"))

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "SSᵃ",
  col = 3,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 5:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 11:12,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Proportion (%) (95% CI)",
  col = 14:15,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- insert_text(
  p_cc_age_sex,
  text = "Heterosexual",
  col = 5:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Homosexual",
  col = 8:9,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Bisexual",
  col = 11:12,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- add_text(
  p_cc_age_sex,
  text = "Uncertain/Otherᵇ",
  col = 14:15,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_age_sex <- edit_plot( p_cc_age_sex,
                           row = c( 1, 6 ), 
                           which = "background",
                           gp = gpar( fill = "white" )
                           )

p_cc_age_sex <- edit_plot( p_cc_age_sex,
                           row = c( 2:5, 7:10 ), 
                           which = "background",
                           gp = gpar( fill = "#eff3f2" )
                           )

p_cc_age_sex <- add_border(
  p_cc_age_sex,
  part = "header",
  row = 2,
  col = c( 5:6, 8:9, 11:12, 14:15 ),
  where = "bottom",
  gp = gpar(lwd = 1)
)

plot( p_cc_age_sex )
```

### 3. Plots for Relation between Sexual Identity and Demographic Factors
#### 3.1. Complete-case analysis
##### 3.1.1. Prepare dataset for plotting
```{r}
results_cc_pr_poisson_2010 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_cc_pr_poisson_2010.xlsx")

results_cc_pr_poisson_2014 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_cc_pr_poisson_2014.xlsx")

results_cc_pr_poisson_2021 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_cc_pr_poisson_2021.xlsx")

colnames(results_cc_pr_poisson_2010)[-1] <- paste0(colnames(results_cc_pr_poisson_2010)[-1], "_2010")
colnames(results_cc_pr_poisson_2014)[-1] <- paste0(colnames(results_cc_pr_poisson_2014)[-1], "_2014")
colnames(results_cc_pr_poisson_2021)[-1] <- paste0(colnames(results_cc_pr_poisson_2021)[-1], "_2021")

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
results_cc_pr_poisson_2010$Exposure[ results_cc_pr_poisson_2010$Exposure == "age_exp18-29" ] <- "age_exp16-29"
results_cc_pr_poisson_2010$Exposure[ results_cc_pr_poisson_2010$Exposure == "age_exp18-29_Male" ] <- "age_exp16-29_Male"
results_cc_pr_poisson_2010$Exposure[ results_cc_pr_poisson_2010$Exposure == "age_exp18-29_Female" ] <- "age_exp16-29_Female"

# merge datasets
results_cc_pr_poisson <- results_cc_pr_poisson_2010 %>%
  full_join( results_cc_pr_poisson_2014, by = "Exposure" ) %>%
  full_join( results_cc_pr_poisson_2021, by = "Exposure" )

# modify table format
desired_order <- c( "sex_expFemale", "age_exp16-29", "age_exp30-44", "age_exp>=60", "age_exp16-29_Male", "age_exp30-44_Male", "age_exp>=60_Male", "age_exp16-29_Female", "age_exp30-44_Female", "age_exp>=60_Female", "country_of_birth_expEurope", "country_of_birth_expOutside Europe", "education_exp<=9 years", "education_exp10-12 years", "income_exp<=2,500", "income_exp(2,500, 3,500]", "income_exp(3,500, 4,500]", "marital_status_expNever married", "marital_status_expOther", "living_status_expyes", "personal_support_expno" )
                    
results_cc_pr_poisson <- results_cc_pr_poisson %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Sex", .before = 1 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Age group", .before = 3 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Country of birth", .before = 13 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Education years", .before = 16 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Income (100 kr/yr)ᶠ", .before = 19 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Marital statusᵍ", .before = 23 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Living alone", .before = 26 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = "Personal support", .before = 28 )

results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "sex_expFemale" ] <- paste0( "   ", "Female\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "age_exp16-29" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "age_exp30-44" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "age_exp>=60" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "country_of_birth_expEurope" ] <- paste0( "   ", "Europeᵉ\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "country_of_birth_expOutside Europe" ] <- paste0( "   ", "Outside Europe\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "education_exp<=9 years" ] <- paste0( "   ", "\u2264 9 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "education_exp10-12 years" ] <- paste0( "   ", "10–12 yrs\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "income_exp<=2,500" ] <- paste0( "   ", "\u2264 2,500\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "income_exp(2,500, 3,500]" ] <- paste0( "   ", "(2,500, 3,500]\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "income_exp(3,500, 4,500]" ] <- paste0( "   ", "(3,500, 4,500]\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "marital_status_expNever married" ] <- paste0( "   ", "Never married\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "marital_status_expOther" ] <- paste0( "   ", "Other\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "living_status_expyes" ] <- paste0( "   ", "Yes\n\n" )
results_cc_pr_poisson$Exposure[ results_cc_pr_poisson$Exposure == "personal_support_expno" ] <- paste0( "   ", "No\n\n" )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_crude_2010 ), ")" ),
    .before = 2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_1_2010 ), ")" ),
    .before = 3 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_2_2010 ), ")" ),
    .before = 4 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_crude_2010 ), ")" ),
    .before = 5 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_1_2010 ), ")" ),
    .before = 6 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_2_2010 ), ")" ),
    .before = 7 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_crude_2010 ), ")" ),
    .before = 8 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_1_2010 ), ")" ),
    .before = 9 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_2_2010 ), ")" ),
    .before = 10 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2010_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_crude_2010 ), ")" ),
    .before = 11 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2010_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_1_2010 ), ")" ),
    .before = 12 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2010_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_2_2010 ), ")" ),
    .before = 13 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_crude_2014 ), ")" ),
    .before = 14 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_1_2014 ), ")" ),
    .before = 15 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_2_2014 ), ")" ),
    .before = 16 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_crude_2014 ), ")" ),
    .before = 17 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_1_2014 ), ")" ),
    .before = 18 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_2_2014 ), ")" ),
    .before = 19 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_crude_2014 ), ")" ),
    .before = 20 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_1_2014 ), ")" ),
    .before = 21 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_2_2014 ), ")" ),
    .before = 22 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2014_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_crude_2014 ), ")" ),
    .before = 23 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2014_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_1_2014 ), ")" ),
    .before = 24 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2014_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_2_2014 ), ")" ),
    .before = 25 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_crude_2021 ), ")" ),
    .before = 26 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_1_2021 ), ")" ),
    .before = 27 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$sexual_minority_upper_ci_model_2_2021 ), ")" ),
    .before = 28 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_crude_2021 ), ")" ),
    .before = 29 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_1_2021 ), ")" ),
    .before = 30 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$homosexual_upper_ci_model_2_2021 ), ")" ),
    .before = 31 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_crude_2021 ), ")" ),
    .before = 32 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_1_2021 ), ")" ),
    .before = 33 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$bisexual_upper_ci_model_2_2021 ), ")" ),
    .before = 34 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2021_crude" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_crude_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_crude_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_crude_2021 ), ")" ),
    .before = 35 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2021_model_1" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_1_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_1_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_1_2021 ), ")" ),
    .before = 36 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_2021_model_2" = paste0(
    sprintf( "%.2f", results_cc_pr_poisson$other_point_estimate_model_2_2021 ), " (", 
    sprintf( "%.2f", results_cc_pr_poisson$other_lower_ci_model_2_2021 ), ", ", 
    sprintf( "%.2f", results_cc_pr_poisson$other_upper_ci_model_2_2021 ), ")" ),
    .before = 37 )


results_cc_pr_poisson$Sexual_minority_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Sexual_minority_2021_crude )

results_cc_pr_poisson$Sexual_minority_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Sexual_minority_2021_model_1 )

results_cc_pr_poisson$Sexual_minority_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Sexual_minority_2021_model_2 )

results_cc_pr_poisson$Homosexual_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Homosexual_2021_crude )

results_cc_pr_poisson$Homosexual_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Homosexual_2021_model_1 )

results_cc_pr_poisson$Homosexual_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Homosexual_2021_model_2 )

results_cc_pr_poisson$Bisexual_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Bisexual_2021_crude )

results_cc_pr_poisson$Bisexual_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Bisexual_2021_model_1 )

results_cc_pr_poisson$Bisexual_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Bisexual_2021_model_2 )

results_cc_pr_poisson$Other_2021_crude <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Other_2021_crude )

results_cc_pr_poisson$Other_2021_model_1 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Other_2021_model_1 )

results_cc_pr_poisson$Other_2021_model_2 <- ifelse( !is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2010 ) & is.na( results_cc_pr_poisson$sexual_minority_point_estimate_model_1_2021 ), "\u2013",
                                                      results_cc_pr_poisson$Other_2021_model_2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_crude" = paste( results_cc_pr_poisson$Sexual_minority_2010_crude,
                                               results_cc_pr_poisson$Sexual_minority_2014_crude,
                                               results_cc_pr_poisson$Sexual_minority_2021_crude,
                                               sep = "\n" ),
              .before = 2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_model_1" = paste( results_cc_pr_poisson$Sexual_minority_2010_model_1,
                                                 results_cc_pr_poisson$Sexual_minority_2014_model_1,
                                                 results_cc_pr_poisson$Sexual_minority_2021_model_1,
                                                 sep = "\n" ),
              .before = 3 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Sexual_minority_model_2" = paste( results_cc_pr_poisson$Sexual_minority_2010_model_2,
                                                 results_cc_pr_poisson$Sexual_minority_2014_model_2,
                                                 results_cc_pr_poisson$Sexual_minority_2021_model_2,
                                                 sep = "\n" ),
              .before = 4 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_crude" = paste( results_cc_pr_poisson$Homosexual_2010_crude,
                                          results_cc_pr_poisson$Homosexual_2014_crude,
                                          results_cc_pr_poisson$Homosexual_2021_crude,
                                          sep = "\n" ),
              .before = 5 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_model_1" = paste( results_cc_pr_poisson$Homosexual_2010_model_1,
                                            results_cc_pr_poisson$Homosexual_2014_model_1,
                                            results_cc_pr_poisson$Homosexual_2021_model_1,
                                            sep = "\n" ),
              .before = 6 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Homosexual_model_2" = paste( results_cc_pr_poisson$Homosexual_2010_model_2,
                                            results_cc_pr_poisson$Homosexual_2014_model_2,
                                            results_cc_pr_poisson$Homosexual_2021_model_2,
                                            sep = "\n" ),
              .before = 7 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_crude" = paste( results_cc_pr_poisson$Bisexual_2010_crude,
                                        results_cc_pr_poisson$Bisexual_2014_crude,
                                        results_cc_pr_poisson$Bisexual_2021_crude,
                                        sep = "\n" ),
              .before = 8 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_model_1" = paste( results_cc_pr_poisson$Bisexual_2010_model_1,
                                          results_cc_pr_poisson$Bisexual_2014_model_1,
                                          results_cc_pr_poisson$Bisexual_2021_model_1,
                                          sep = "\n" ),
              .before = 9 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Bisexual_model_2" = paste( results_cc_pr_poisson$Bisexual_2010_model_2,
                                          results_cc_pr_poisson$Bisexual_2014_model_2,
                                          results_cc_pr_poisson$Bisexual_2021_model_2,
                                          sep = "\n" ),
              .before = 10 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_crude" = paste( results_cc_pr_poisson$Other_2010_crude,
                                     results_cc_pr_poisson$Other_2014_crude,
                                     results_cc_pr_poisson$Other_2021_crude,
                                     sep = "\n" ),
              .before = 11 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_model_1" = paste( results_cc_pr_poisson$Other_2010_model_1,
                                       results_cc_pr_poisson$Other_2014_model_1,
                                       results_cc_pr_poisson$Other_2021_model_1,
                                       sep = "\n" ),
              .before = 12 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_column( "Other_model_2" = paste( results_cc_pr_poisson$Other_2010_model_2,
                                       results_cc_pr_poisson$Other_2014_model_2,
                                       results_cc_pr_poisson$Other_2021_model_2,
                                       sep = "\n" ),
              .before = 13 )


results_cc_pr_poisson$Sexual_minority_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Sexual_minority_crude )

results_cc_pr_poisson$Sexual_minority_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Sexual_minority_model_1 )

results_cc_pr_poisson$Sexual_minority_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Sexual_minority_model_2 )

results_cc_pr_poisson$Homosexual_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Homosexual_crude )

results_cc_pr_poisson$Homosexual_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Homosexual_model_1 )

results_cc_pr_poisson$Homosexual_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Homosexual_model_2 )

results_cc_pr_poisson$Bisexual_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Bisexual_crude )

results_cc_pr_poisson$Bisexual_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Bisexual_model_1 )

results_cc_pr_poisson$Bisexual_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Bisexual_model_2 )

results_cc_pr_poisson$Other_crude <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Other_crude )

results_cc_pr_poisson$Other_model_1 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Other_model_1 )

results_cc_pr_poisson$Other_model_2 <- ifelse( is.na( results_cc_pr_poisson$sexual_minority_point_estimate_crude_2010 ), "",
                                                      results_cc_pr_poisson$Other_model_2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Male" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 2 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 7 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Sweden" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 16 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "\u2265 13 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 22 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "> 4,500" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 27 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Currently married" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 29 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "No" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 34 )

results_cc_pr_poisson <- results_cc_pr_poisson %>% 
  add_row( Exposure = paste0( "   ", "Yes" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 36 )
```

##### 3.1.2. Sexual minority group
###### 3.1.2.1. Part 1
```{r}
selected_cols <- grep( "exposure|sexual_minority", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson[ -c( 9:14, 23:37 ), selected_cols ]

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_sexual_minority )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_sexual_minority )[ names( results_cc_pr_poisson_sexual_minority ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
  )

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_sexual_minority[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2021
              ),
  
  lower = list( results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2021
                ),
  
  upper = list( results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2021
                ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 4, 9, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
                                              )

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 4, 9, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
                                              )

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
                                              )

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

###### 3.1.2.2. Part 2
```{r}
results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson[ -c( 1:22 ), selected_cols ]

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_sexual_minority <- results_cc_pr_poisson_sexual_minority %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_sexual_minority )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_sexual_minority )[ names( results_cc_pr_poisson_sexual_minority ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
  )

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_sexual_minority[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_sexual_minority$sexual_minority_point_estimate_model_2_2021
              ),
  
  lower = list( results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_lower_ci_model_2_2021
                ),
  
  upper = list( results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_sexual_minority$sexual_minority_upper_ci_model_2_2021
                ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6, 10, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6, 10, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
                                              )

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
                                              )

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

##### 3.1.3. Homosexual group
###### 3.1.3.1. Part 1
```{r}
selected_cols <- grep( "exposure|homosexual", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson[ -c( 9:14, 23:37 ), selected_cols ]

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_homosexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_homosexual )[ names( results_cc_pr_poisson_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 4, 9, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 4, 9, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
```

###### 3.1.3.2. Part 2
```{r}
results_cc_pr_poisson_homosexual <- results_cc_pr_poisson[ -c( 1:22 ), selected_cols ]

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_homosexual <- results_cc_pr_poisson_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_homosexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_homosexual )[ names( results_cc_pr_poisson_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 6, 10, 13 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 1, 6, 10, 13 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                         row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
```

##### 3.1.4. Bisexual group
###### 3.1.4.1. Part 1
```{r}
selected_cols <- grep( "exposure|bisexual", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson[ -c( 9:14, 23:37 ), selected_cols ]

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_bisexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_bisexual )[ names( results_cc_pr_poisson_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 4, 9, 13 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 4, 9, 13 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
```

###### 3.1.4.2. Part 2
```{r}
results_cc_pr_poisson_bisexual <- results_cc_pr_poisson[ -c( 1:22 ), selected_cols ]

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_bisexual <- results_cc_pr_poisson_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_bisexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_bisexual )[ names( results_cc_pr_poisson_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 6, 10, 13 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 1, 6, 10, 13 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                       row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
```

##### 3.1.5. Other group
###### 3.1.5.1. Part 1
```{r}
selected_cols <- grep( "exposure|other", colnames( results_cc_pr_poisson ), ignore.case = TRUE )

results_cc_pr_poisson_other <- results_cc_pr_poisson[ -c( 9:14, 23:37 ), selected_cols ]

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_other )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_other )[ names( results_cc_pr_poisson_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 10 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8, 10 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 4, 9, 13 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 4, 9, 13 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

###### 3.1.5.2. Part 2
```{r}
results_cc_pr_poisson_other <- results_cc_pr_poisson[ -c( 1:22 ), selected_cols ]

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_other <- results_cc_pr_poisson_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_other )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_other )[ names( results_cc_pr_poisson_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 10 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8, 10 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 6, 10, 13 ),
                                    col = 1,
                                    gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 1, 6, 10, 13 ), 
                                    which = "background",
                                    gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                    row = c( 2:5, 7:9, 11, 12, 14, 15 ), 
                                    which = "background",
                                    gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

##### 3.1.6. Age by sex
###### 3.1.6.1. Prepare dataset for plotting
```{r}
results_cc_pr_poisson_age_sex <- results_cc_pr_poisson[ c( 9:14 ), ]

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = "Male", .before = 1 )

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = "Female", .before = 5 )

results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp16-29_Male" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp30-44_Male" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp>=60_Male" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )

results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp16-29_Female" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp30-44_Female" ] <- paste0( "   ", "30–44 yrs\n\n" )
results_cc_pr_poisson_age_sex$Exposure[ results_cc_pr_poisson_age_sex$Exposure == "age_exp>=60_Female" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 4 )

results_cc_pr_poisson_age_sex <- results_cc_pr_poisson_age_sex %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_minority_crude = "Reference",
           Sexual_minority_model_1 = "Reference",
           Sexual_minority_model_2 = "Reference",
           Homosexual_crude = "Reference",
           Homosexual_model_1 = "Reference",
           Homosexual_model_2 = "Reference",
           Bisexual_crude = "Reference",
           Bisexual_model_1 = "Reference",
           Bisexual_model_2 = "Reference",
           Other_crude = "Reference",
           Other_model_1 = "Reference",
           Other_model_2 = "Reference",
           .before = 9 )

results_cc_pr_poisson_age_sex$Sexual_minority_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Sexual_minority_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Sexual_minority_crude )

results_cc_pr_poisson_age_sex$Sexual_minority_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Sexual_minority_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Sexual_minority_model_1 )

results_cc_pr_poisson_age_sex$Sexual_minority_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Sexual_minority_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Sexual_minority_model_2 )

results_cc_pr_poisson_age_sex$Homosexual_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Homosexual_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Homosexual_crude )

results_cc_pr_poisson_age_sex$Homosexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Homosexual_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Homosexual_model_1 )

results_cc_pr_poisson_age_sex$Homosexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Homosexual_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Homosexual_model_2 )

results_cc_pr_poisson_age_sex$Bisexual_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Bisexual_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Bisexual_crude )

results_cc_pr_poisson_age_sex$Bisexual_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Bisexual_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Bisexual_model_1 )

results_cc_pr_poisson_age_sex$Bisexual_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Bisexual_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Bisexual_model_2 )

results_cc_pr_poisson_age_sex$Other_crude <- ifelse( is.na( results_cc_pr_poisson_age_sex$Other_crude ), "",
                                                      results_cc_pr_poisson_age_sex$Other_crude )

results_cc_pr_poisson_age_sex$Other_model_1 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Other_model_1 ), "",
                                                      results_cc_pr_poisson_age_sex$Other_model_1 )

results_cc_pr_poisson_age_sex$Other_model_2 <- ifelse( is.na( results_cc_pr_poisson_age_sex$Other_model_2 ), "",
                                                      results_cc_pr_poisson_age_sex$Other_model_2 )
```

###### 3.1.6.2. Sexual minority group
```{r}
selected_cols <- grep( "exposure|sexual_minority", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_sexual_minorities <- results_cc_pr_poisson_age_sex_sexual_minorities %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_sexual_minorities )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_age_sex_sexual_minorities )[ names( results_cc_pr_poisson_age_sex_sexual_minorities ) %in% c( "temp1", "temp2", "temp3", "Sexual_minority_crude", "Sexual_minority_model_1", "Sexual_minority_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_sexual_minority <- forest(
  results_cc_pr_poisson_age_sex_sexual_minorities[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_sexual_minorities$sexual_minority_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- add_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- insert_text(
  p_cc_pr_poisson_sexual_minority,
  text = "Sexual Minoritiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_minority <- edit_plot( p_cc_pr_poisson_sexual_minority,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_minority <- add_border(
  p_cc_pr_poisson_sexual_minority,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_minority )
```

###### 3.1.6.3. Homosexual group
```{r}
selected_cols <- grep( "exposure|homosexual", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_homosexual <- results_cc_pr_poisson_age_sex_homosexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_homosexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_age_sex_homosexual )[ names( results_cc_pr_poisson_age_sex_homosexual ) %in% c( "temp1", "temp2", "temp3", "Homosexual_crude", "Homosexual_model_1", "Homosexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_homosexual <- forest(
  results_cc_pr_poisson_age_sex_homosexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_homosexual$homosexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_homosexual$homosexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- add_text(
  p_cc_pr_poisson_homosexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- insert_text(
  p_cc_pr_poisson_homosexual,
  text = "Homosexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_homosexual <- edit_plot( p_cc_pr_poisson_homosexual,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_homosexual <- add_border(
  p_cc_pr_poisson_homosexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_homosexual )
```

###### 3.1.6.4. Bisexual group
```{r}
selected_cols <- grep( "exposure|bisexual", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_bisexual <- results_cc_pr_poisson_age_sex_bisexual %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_bisexual )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_age_sex_bisexual )[ names( results_cc_pr_poisson_age_sex_bisexual ) %in% c( "temp1", "temp2", "temp3", "Bisexual_crude", "Bisexual_model_1", "Bisexual_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_bisexual <- forest(
  results_cc_pr_poisson_age_sex_bisexual[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_bisexual$bisexual_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_bisexual$bisexual_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 8 ),
  ticks_at = c( 0, 1, 2, 4, 6, 8 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 6 ),
                                         col = 1,
                                         gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- add_text(
  p_cc_pr_poisson_bisexual,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- insert_text(
  p_cc_pr_poisson_bisexual,
  text = "Bisexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 1, 6 ), 
                                         which = "background",
                                         gp = gpar( fill = "white" )
)

p_cc_pr_poisson_bisexual <- edit_plot( p_cc_pr_poisson_bisexual,
                                         row = c( 2:5, 7:10 ), 
                                         which = "background",
                                         gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_bisexual <- add_border(
  p_cc_pr_poisson_bisexual,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_bisexual )
```

###### 3.1.6.5. Other group
```{r}
selected_cols <- grep( "exposure|other", colnames( results_cc_pr_poisson_age_sex ), ignore.case = TRUE )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex[ , selected_cols ]

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

results_cc_pr_poisson_age_sex_other <- results_cc_pr_poisson_age_sex_other %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( results_cc_pr_poisson_age_sex_other )[1] <- "Demographic Factor"

names( results_cc_pr_poisson_age_sex_other )[ names( results_cc_pr_poisson_age_sex_other ) %in% c( "temp1", "temp2", "temp3", "Other_crude", "Other_model_1", "Other_model_2" ) ] <- ""

tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

p_cc_pr_poisson_other <- forest(
  results_cc_pr_poisson_age_sex_other[ , c( 1:10 ) ],
  
  est = list( results_cc_pr_poisson_age_sex_other$other_point_estimate_crude_2010,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_1_2010,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_2_2010,
              
              results_cc_pr_poisson_age_sex_other$other_point_estimate_crude_2014,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_1_2014,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_2_2014,
              
              results_cc_pr_poisson_age_sex_other$other_point_estimate_crude_2021,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_1_2021,
              results_cc_pr_poisson_age_sex_other$other_point_estimate_model_2_2021
  ),
  
  lower = list( results_cc_pr_poisson_age_sex_other$other_lower_ci_crude_2010,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_other$other_lower_ci_crude_2014,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_other$other_lower_ci_crude_2021,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_other$other_lower_ci_model_2_2021
  ),
  
  upper = list( results_cc_pr_poisson_age_sex_other$other_upper_ci_crude_2010,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_1_2010,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_2_2010,
                
                results_cc_pr_poisson_age_sex_other$other_upper_ci_crude_2014,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_1_2014,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_2_2014,
                
                results_cc_pr_poisson_age_sex_other$other_upper_ci_crude_2021,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_1_2021,
                results_cc_pr_poisson_age_sex_other$other_upper_ci_model_2_2021
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Proportion Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 6 ),
                                       col = 1,
                                       gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Crude Proportion Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 1, Proportion Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- add_text(
  p_cc_pr_poisson_other,
  text = "Model 2, Proportion Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- insert_text(
  p_cc_pr_poisson_other,
  text = "Uncertain/Other Sexual Identitiesᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 1, 6 ), 
                                       which = "background",
                                       gp = gpar( fill = "white" )
)

p_cc_pr_poisson_other <- edit_plot( p_cc_pr_poisson_other,
                                       row = c( 2:5, 7:10 ), 
                                       which = "background",
                                       gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_other <- add_border(
  p_cc_pr_poisson_other,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_other )
```

##### 3.1.7. Proportion and proportion ratio by varing age cut-offs
###### 3.1.7.1. Prepare dataset for plotting
```{r}
prop_cc_age_iteration_2010 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_cc_age_iteration_2010.xlsx") %>%
  select( "cut_off", "Heterosexual_young", "Homosexual_young", "Bisexual_young", "Uncertain_young", "Heterosexual_pr_2010", "Homosexual_pr_2010", "Bisexual_pr_2010", "Uncertain_pr_2010" ) %>%
  rename( 
    Heterosexual_prop_2010 = Heterosexual_young,
    Homosexual_prop_2010 = Homosexual_young,
    Bisexual_prop_2010 = Bisexual_young,
    Other_prop_2010 = Uncertain_young,
    Other_pr_2010 = Uncertain_pr_2010
    )

prop_cc_age_iteration_2014 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_cc_age_iteration_2014.xlsx") %>%
  select( "cut_off", "Heterosexual_young", "Homosexual_young", "Bisexual_young", "None of the above_young", "Heterosexual_pr_2014", "Homosexual_pr_2014", "Bisexual_pr_2014", "None of the above_pr_2014" ) %>%
  rename( 
    Heterosexual_prop_2014 = Heterosexual_young,
    Homosexual_prop_2014 = Homosexual_young,
    Bisexual_prop_2014 = Bisexual_young,
    Other_prop_2014 = `None of the above_young`,
    Other_pr_2014 = `None of the above_pr_2014`
    )

prop_cc_age_iteration_2021 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/prop_cc_age_iteration_2021.xlsx") %>%
  select( "cut_off", "Heterosexual_young", "Homosexual_young", "Bisexual_young", "None of the above_young", "Heterosexual_pr_2021", "Homosexual_pr_2021", "Bisexual_pr_2021", "None of the above_pr_2021" ) %>%
  rename( 
    Heterosexual_prop_2021 = Heterosexual_young,
    Homosexual_prop_2021 = Homosexual_young,
    Bisexual_prop_2021 = Bisexual_young,
    Other_prop_2021 = `None of the above_young`,
    Other_pr_2021 = `None of the above_pr_2021`
    )

prop_cc_age_iteration_merged <- prop_cc_age_iteration_2010 %>%
  full_join( prop_cc_age_iteration_2014, by = "cut_off" ) %>%
  full_join( prop_cc_age_iteration_2021, by = "cut_off" )

long_data <- prop_cc_age_iteration_merged %>% 
  pivot_longer( 
    cols = - cut_off, 
    names_to = c( "Sexuality", "Age_Group", "Year" ), 
    names_pattern = "([A-Za-z]+)_(\\w+)_(\\d+)", 
    values_to = "Value" 
  )
```

###### 3.1.7.2. Proportion
```{r}
ggplot( long_data[ long_data$Age_Group == "prop", ], 
        aes( x = cut_off, y = Value, color = Sexuality, linetype = Year ) 
        ) +
  
  geom_line( ) +
  
  scale_linetype_manual( values = c( "2010" = "dotdash", "2014" = "dashed", "2021" = "solid" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ) 
                         ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Heterosexual", "Homosexual", "Bisexual", "Other" ),
                      labels = c( "Heterosexual", "Homosexual", "Bisexual", "Otherᶜ" )
                      ) +
  
  scale_x_continuous( limits = c( 15, 100 ), 
                      breaks = seq( 15, 100, by = 5 ),
                      expand = c( 0.02, 0 )
                      ) +
  
  scale_y_continuous( labels = scales::percent,
                      limits = c( 0, 1 ), 
                      breaks = c( 0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.7, 0.8, 0.9, 1 )
                      ) +
  
  scale_y_break( c( 0.12, 0.75 ), scales = 1, space = 0.3, expand = c( 0, 0 ) ) +
  
  labs( x = "Age cut-off (years)ᵃ", 
        y = "Proportionᵇ"
        ) +
  
  theme_classic() +
  
  theme( axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.position = "right",
         legend.title = element_blank(),
         axis.text.y.right = element_blank(),
         axis.ticks.y.right = element_blank(),
         axis.line.y.right = element_blank()
         )
```

###### 3.1.7.3. Proportion ratio
```{r}
ggplot( long_data[ long_data$Age_Group == "pr", ], 
        aes( x = cut_off, y = Value, color = Sexuality, linetype = Year ) 
        ) +
  
  geom_line( ) +
  
  scale_linetype_manual( values = c( "2010" = "dotdash", "2014" = "dashed", "2021" = "solid" ),
                         labels = c( "SPHC-B 2010", "SPHC-B 2014", "SPHC-B 2021" ) 
                         ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Heterosexual", "Homosexual", "Bisexual", "Other" ),
                      labels = c( "Heterosexual", "Homosexual", "Bisexual", "Otherᶜ" )
                      ) +
  
  scale_x_continuous( limits = c( 15, 65 ), 
                      breaks = c( 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65 ),
                      expand = c( 0.02, 0 )
                      ) +
  
  scale_y_continuous( limits = c( 0, 7 ), 
                      breaks = c( 0, 1, 2, 3, 4, 5, 6, 7 ),
                      expand = c( 0.04, 0 ) 
                      ) +
  
  labs( x = "Age cut-off (years)ᵃ", 
        y = "Proportion ratioᵇ"
        ) +
  
  theme_classic() +
  
  theme( axis.text.y = element_text( family = "Arial", size = 11 ),
         axis.title.y = element_text( family = "Arial", size = 11 ),
         axis.title.x = element_text( family = "Arial", size = 11 ),
         axis.text.x = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         legend.position = "right",
         legend.title = element_blank()
         )
```

##### 3.1.8. Compare across models
###### 3.1.8.1. SPHC-B 2010
```{r}
results_cc_pr_all_models_2010 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_cc_pr_all_models_2010.xlsx")

results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "sex_expFemale" ] <- "Sex: Female"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp18-29" ] <- "Age: 18–29 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp30-44" ] <- "Age: 30–44 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp>=60" ] <- "Age: \u2265 60 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp18-29_Male" ] <- "Age: 18–29 yrs (among males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp30-44_Male" ] <- "Age: 30–44 yrs (among males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp>=60_Male" ] <- "Age: \u2265 60 yrs (among males)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp18-29_Female" ] <- "Age: 18–29 yrs (among females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp30-44_Female" ] <- "Age: 30–44 yrs (among females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "age_exp>=60_Female" ] <- "Age: \u2265 60 yrs (among females)"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "country_of_birth_expEurope" ] <- "Country of birth: Europeᵃ"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "country_of_birth_expOutside Europe" ] <- "Country of birth: Outside Europe"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp<=9 years" ] <- "Education: \u2264 9 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "education_exp10-12 years" ] <- "Education: 10–12 yrs"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp<=2,500" ] <- "Incomeᵇ: \u2264 2,500"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(2,500, 3,500]" ] <- "Incomeᵇ: (2,500, 3,500]"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "income_exp(3,500, 4,500]" ] <- "Incomeᵇ: (3,500, 4,500]"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "marital_status_expNever married" ] <- "Marital status: Never married"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "marital_status_expOther" ] <- "Marital status: Otherᶜ"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "living_status_expyes" ] <- "Living alone: Yes"
results_cc_pr_all_models_2010$Exposure[ results_cc_pr_all_models_2010$Exposure == "personal_support_expno" ] <- "Personal support: No"

desired_order <- c( "Sex: Female", "Age: 18–29 yrs", "Age: 30–44 yrs", "Age: ≥ 60 yrs", "Age: 18–29 yrs (among males)", "Age: 30–44 yrs (among males)", "Age: ≥ 60 yrs (among males)", "Age: 18–29 yrs (among females)", "Age: 30–44 yrs (among females)", "Age: ≥ 60 yrs (among females)", "Country of birth: Europeᵃ", "Country of birth: Outside Europe", "Education: ≤ 9 yrs", "Education: 10–12 yrs", "Incomeᵇ: ≤ 2,500", "Incomeᵇ: (2,500, 3,500]", "Incomeᵇ: (3,500, 4,500]", "Marital status: Never married", "Marital status: Otherᶜ", "Living alone: Yes", "Personal support: No" )
                    
results_cc_pr_all_models_2010 <- results_cc_pr_all_models_2010 %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_all_models_2010 <- results_cc_pr_all_models_2010[ , !grepl( "model_1", names(results_cc_pr_all_models_2010 ) ) ]
names( results_cc_pr_all_models_2010 ) <- gsub( "model_2_poisson", "poisson", names( results_cc_pr_all_models_2010 ) )

long_data_2010 <- results_cc_pr_all_models_2010 %>%
  pivot_longer(
    cols = !Exposure, 
    names_to = "Identity_Statistic_Model", 
    values_to = "Value"
    )

long_data_2010 <- long_data_2010 %>%
  extract(
    col = Identity_Statistic_Model, 
    into = c( "Identity", "Statistic", "Model" ),
    regex = "^(.+?)_(lower_ci|upper_ci|point_estimate)_(\\w+)$",
    remove = TRUE
  )

long_data_2010 <- long_data_2010 %>%
  pivot_wider(
    names_from = Statistic, 
    values_from = Value
    )

long_data_2010 <- long_data_2010 %>%
  mutate(
    Identity = factor(
      case_when(
        Identity == "sexual_minority" ~ "Sexual minorities",
        Identity == "homosexual" ~ "Homosexual",
        Identity == "bisexual" ~ "Bisexual",
        Identity == "other" ~ "Uncertain"
        ),
      levels = c( "Sexual minorities", "Homosexual", "Bisexual", "Uncertain" )
      ),
    
    Model = factor(
      case_when(
        Model == "poisson" ~ "Poisson (PR)",
        Model == "log_binomial" ~ "Log-binomial (PR)",
        Model == "logistic" ~ "Logistic (OR)"
        ),
      levels = c("Poisson (PR)", "Log-binomial (PR)", "Logistic (OR)")
    )
  )


ggplot( long_data_2010, 
        aes( x = Identity, y = point_estimate, color = Identity, shape = Model ) ) +
  
  geom_point( position = position_dodge( width = 0.5 ) ) +
  geom_errorbar( aes( ymin = lower_ci, ymax = upper_ci ), 
                 position = position_dodge( width = 0.5 ), width = 0.2 ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Sexual minorities", "Homosexual", "Bisexual", "Uncertain" )  ) +
  
  facet_wrap( ~ Exposure, scales = "free_y" ) +
  
  theme_minimal() +
  
  labs( x = NULL, y = "Point Estimate (95% CI)", color = "Sexual Identity", shape = "Model" ) +
  
  theme( axis.text.x = element_blank(),
         axis.title.y = element_text( family = "Arial", size = 11, margin = margin( r = 10, unit = "pt" ) ),
         legend.title = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         strip.text = element_text( family = "Arial", size = 9 )
         )
```

###### 3.1.8.2. SPHC-B 2014
```{r}
results_cc_pr_all_models_2014 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_cc_pr_all_models_2014.xlsx")

results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "sex_expFemale" ] <- "Sex: Female"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp16-29" ] <- "Age: 16–29 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp30-44" ] <- "Age: 30–44 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp>=60" ] <- "Age: \u2265 60 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp16-29_Male" ] <- "Age: 16–29 yrs (among males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp30-44_Male" ] <- "Age: 30–44 yrs (among males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp>=60_Male" ] <- "Age: \u2265 60 yrs (among males)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp16-29_Female" ] <- "Age: 16–29 yrs (among females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp30-44_Female" ] <- "Age: 30–44 yrs (among females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "age_exp>=60_Female" ] <- "Age: \u2265 60 yrs (among females)"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "country_of_birth_expEurope" ] <- "Country of birth: Europeᵃ"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "country_of_birth_expOutside Europe" ] <- "Country of birth: Outside Europe"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp<=9 years" ] <- "Education: \u2264 9 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "education_exp10-12 years" ] <- "Education: 10–12 yrs"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp<=2,500" ] <- "Incomeᵇ: \u2264 2,500"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(2,500, 3,500]" ] <- "Incomeᵇ: (2,500, 3,500]"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "income_exp(3,500, 4,500]" ] <- "Incomeᵇ: (3,500, 4,500]"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "marital_status_expNever married" ] <- "Marital status: Never married"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "marital_status_expOther" ] <- "Marital status: Otherᶜ"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "living_status_expyes" ] <- "Living alone: Yes"
results_cc_pr_all_models_2014$Exposure[ results_cc_pr_all_models_2014$Exposure == "personal_support_expno" ] <- "Personal support: No"

desired_order <- c( "Sex: Female", "Age: 16–29 yrs", "Age: 30–44 yrs", "Age: ≥ 60 yrs", "Age: 16–29 yrs (among males)", "Age: 30–44 yrs (among males)", "Age: ≥ 60 yrs (among males)", "Age: 16–29 yrs (among females)", "Age: 30–44 yrs (among females)", "Age: ≥ 60 yrs (among females)", "Country of birth: Europeᵃ", "Country of birth: Outside Europe", "Education: ≤ 9 yrs", "Education: 10–12 yrs", "Incomeᵇ: ≤ 2,500", "Incomeᵇ: (2,500, 3,500]", "Incomeᵇ: (3,500, 4,500]", "Marital status: Never married", "Marital status: Otherᶜ", "Living alone: Yes", "Personal support: No" )

results_cc_pr_all_models_2014 <- results_cc_pr_all_models_2014 %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_all_models_2014 <- results_cc_pr_all_models_2014[ , !grepl( "model_1", names(results_cc_pr_all_models_2014 ) ) ]
names( results_cc_pr_all_models_2014 ) <- gsub( "model_2_poisson", "poisson", names( results_cc_pr_all_models_2014 ) )

long_data_2014 <- results_cc_pr_all_models_2014 %>%
  pivot_longer(
    cols = !Exposure, 
    names_to = "Identity_Statistic_Model", 
    values_to = "Value"
  )

long_data_2014 <- long_data_2014 %>%
  extract(
    col = Identity_Statistic_Model, 
    into = c( "Identity", "Statistic", "Model" ),
    regex = "^(.+?)_(lower_ci|upper_ci|point_estimate)_(\\w+)$",
    remove = TRUE
  )

long_data_2014 <- long_data_2014 %>%
  pivot_wider(
    names_from = Statistic, 
    values_from = Value
  )

long_data_2014 <- long_data_2014 %>%
  mutate(
    
    Identity = factor(
      case_when(
        Identity == "sexual_minority" ~ "Sexual minorities",
        Identity == "homosexual" ~ "Homosexual",
        Identity == "bisexual" ~ "Bisexual",
        Identity == "other" ~ "None of the above"
      ),
      levels = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )
    ),
    
    Model = factor(
      case_when(
        Model == "poisson" ~ "Poisson (PR)",
        Model == "log_binomial" ~ "Log-binomial (PR)",
        Model == "logistic" ~ "Logistic (OR)"
      ),
      levels = c("Poisson (PR)", "Log-binomial (PR)", "Logistic (OR)")
    )
  )


ggplot( long_data_2014, 
        aes( x = Identity, y = point_estimate, color = Identity, shape = Model ) ) +
  
  geom_point( position = position_dodge( width = 0.5 ) ) +
  geom_errorbar( aes( ymin = lower_ci, ymax = upper_ci ), 
                 position = position_dodge( width = 0.5 ), width = 0.2 ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )  ) +
  
  facet_wrap( ~ Exposure, scales = "free_y" ) +
  
  theme_minimal() +
  
  labs( x = NULL, y = "Point Estimate (95% CI)", color = "Sexual Identity", shape = "Model" ) +
  
  theme( axis.text.x = element_blank(),
         axis.title.y = element_text( family = "Arial", size = 11, margin = margin( r = 10, unit = "pt" ) ),
         legend.title = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         strip.text = element_text( family = "Arial", size = 9 )
  )
```

###### 3.1.8.3. SPHC-B 2021
```{r}
results_cc_pr_all_models_2021 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/results_cc_pr_all_models_2021.xlsx")

results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "sex_expFemale" ] <- "Sex: Female"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp16-29" ] <- "Age: 16–29 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp30-44" ] <- "Age: 30–44 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp>=60" ] <- "Age: \u2265 60 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp16-29_Male" ] <- "Age: 16–29 yrs (among males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp30-44_Male" ] <- "Age: 30–44 yrs (among males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp>=60_Male" ] <- "Age: \u2265 60 yrs (among males)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp16-29_Female" ] <- "Age: 16–29 yrs (among females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp30-44_Female" ] <- "Age: 30–44 yrs (among females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "age_exp>=60_Female" ] <- "Age: \u2265 60 yrs (among females)"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "country_of_birth_expEurope" ] <- "Country of birth: Europeᵃ"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "country_of_birth_expOutside Europe" ] <- "Country of birth: Outside Europe"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp<=9 years" ] <- "Education: \u2264 9 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "education_exp10-12 years" ] <- "Education: 10–12 yrs"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp<=2,500" ] <- "Incomeᵇ: \u2264 2,500"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(2,500, 3,500]" ] <- "Incomeᵇ: (2,500, 3,500]"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "income_exp(3,500, 4,500]" ] <- "Incomeᵇ: (3,500, 4,500]"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "marital_status_expNever married" ] <- "Marital status: Never married"
results_cc_pr_all_models_2021$Exposure[ results_cc_pr_all_models_2021$Exposure == "marital_status_expOther" ] <- "Marital status: Otherᶜ"

desired_order <- c( "Sex: Female", "Age: 16–29 yrs", "Age: 30–44 yrs", "Age: ≥ 60 yrs", "Age: 16–29 yrs (among males)", "Age: 30–44 yrs (among males)", "Age: ≥ 60 yrs (among males)", "Age: 16–29 yrs (among females)", "Age: 30–44 yrs (among females)", "Age: ≥ 60 yrs (among females)", "Country of birth: Europeᵃ", "Country of birth: Outside Europe", "Education: ≤ 9 yrs", "Education: 10–12 yrs", "Incomeᵇ: ≤ 2,500", "Incomeᵇ: (2,500, 3,500]", "Incomeᵇ: (3,500, 4,500]", "Marital status: Never married", "Marital status: Otherᶜ" )

results_cc_pr_all_models_2021 <- results_cc_pr_all_models_2021 %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

results_cc_pr_all_models_2021 <- results_cc_pr_all_models_2021[ , !grepl( "model_1", names(results_cc_pr_all_models_2021 ) ) ]
names( results_cc_pr_all_models_2021 ) <- gsub( "model_2_poisson", "poisson", names( results_cc_pr_all_models_2021 ) )

long_data_2021 <- results_cc_pr_all_models_2021 %>%
  pivot_longer(
    cols = !Exposure, 
    names_to = "Identity_Statistic_Model", 
    values_to = "Value"
  )

long_data_2021 <- long_data_2021 %>%
  extract(
    col = Identity_Statistic_Model, 
    into = c( "Identity", "Statistic", "Model" ),
    regex = "^(.+?)_(lower_ci|upper_ci|point_estimate)_(\\w+)$",
    remove = TRUE
  )

long_data_2021 <- long_data_2021 %>%
  pivot_wider(
    names_from = Statistic, 
    values_from = Value
  )

long_data_2021 <- long_data_2021 %>%
  mutate(
    
    Identity = factor(
      case_when(
        Identity == "sexual_minority" ~ "Sexual minorities",
        Identity == "homosexual" ~ "Homosexual",
        Identity == "bisexual" ~ "Bisexual",
        Identity == "other" ~ "None of the above"
      ),
      levels = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )
    ),
    
    Model = factor(
      case_when(
        Model == "poisson" ~ "Poisson (PR)",
        Model == "log_binomial" ~ "Log-binomial (PR)",
        Model == "logistic" ~ "Logistic (OR)"
      ),
      levels = c("Poisson (PR)", "Log-binomial (PR)", "Logistic (OR)")
    )
  )


ggplot( long_data_2021, 
        aes( x = Identity, y = point_estimate, color = Identity, shape = Model ) ) +
  
  geom_point( position = position_dodge( width = 0.5 ) ) +
  geom_errorbar( aes( ymin = lower_ci, ymax = upper_ci ), 
                 position = position_dodge( width = 0.5 ), width = 0.2 ) +
  
  scale_color_manual( values = c( "#C77CFF", "#00BFC4", "#7CAE00", "#F8766D" ),
                      breaks = c( "Sexual minorities", "Homosexual", "Bisexual", "None of the above" )  ) +
  
  facet_wrap( ~ Exposure, scales = "free_y" ) +
  
  theme_minimal() +
  
  labs( x = NULL, y = "Point Estimate (95% CI)", color = "Sexual Identity", shape = "Model" ) +
  
  theme( axis.text.x = element_blank(),
         axis.title.y = element_text( family = "Arial", size = 11, margin = margin( r = 10, unit = "pt" ) ),
         legend.title = element_text( family = "Arial", size = 11 ),
         legend.text = element_text( family = "Arial", size = 10 ),
         strip.text = element_text( family = "Arial", size = 9 )
  )
```

### 4. Plots for Proportion of Changes in Sexual Identity
#### 4.1. Prepare dataset for plotting
```{r}
fluidity_cc_prop_summary_2010_2021 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_cc_prop_summary_SPHC-F_2010-2021.xlsx")
fluidity_cc_prop_summary_2010 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_cc_prop_summary_2010.xlsx")
fluidity_cc_prop_summary_2014 <- read_excel("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_cc_prop_summary_2014.xlsx")

fluidity_cc_prop_summary_2010_2021[ 4,1 ] <- "Other_identity"
fluidity_cc_prop_summary_2010_2021 <- fluidity_cc_prop_summary_2010_2021 %>%
  rename( changed_point_estimate = proportion,
          sample_size = count ) %>%
  select( -c( fluid_count ) )
colnames(fluidity_cc_prop_summary_2010_2021)[-1] <- paste0(colnames(fluidity_cc_prop_summary_2010_2021)[-1], "_2010_2021")

colnames(fluidity_cc_prop_summary_2010)[-1] <- paste0(colnames(fluidity_cc_prop_summary_2010)[-1], "_2010")
colnames(fluidity_cc_prop_summary_2014)[-1] <- paste0(colnames(fluidity_cc_prop_summary_2014)[-1], "_2014")

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
fluidity_cc_prop_summary_2010_2021$subgroup[ fluidity_cc_prop_summary_2010_2021$subgroup == "<=29" ] <- "16-29"
fluidity_cc_prop_summary_2010_2021$subgroup[ fluidity_cc_prop_summary_2010_2021$subgroup == "<=29.Male" ] <- "16-29.Male"
fluidity_cc_prop_summary_2010_2021$subgroup[ fluidity_cc_prop_summary_2010_2021$subgroup == "<=29.Female" ] <- "16-29.Female"

fluidity_cc_prop_summary_2010$subgroup[ fluidity_cc_prop_summary_2010$subgroup == "Uncertain" ] <- "Other_identity"
fluidity_cc_prop_summary_2010$subgroup[ fluidity_cc_prop_summary_2010$subgroup == "18-29" ] <- "16-29"
fluidity_cc_prop_summary_2010$subgroup[ fluidity_cc_prop_summary_2010$subgroup == "18-29.Male" ] <- "16-29.Male"
fluidity_cc_prop_summary_2010$subgroup[ fluidity_cc_prop_summary_2010$subgroup == "18-29.Female" ] <- "16-29.Female"

fluidity_cc_prop_summary_2014$subgroup[ fluidity_cc_prop_summary_2014$subgroup == "None of the above" ] <- "Other_identity"

# merge datasets
fluidity_cc_prop_summary <- fluidity_cc_prop_summary_2010_2021 %>%
  full_join( fluidity_cc_prop_summary_2010, by = "subgroup" ) %>%
  full_join( fluidity_cc_prop_summary_2014, by = "subgroup" )

# modify table format
desired_order <- c( "Heterosexual", "Homosexual", "Bisexual", "Other_identity", "Male", "Female", "16-29", "30-44", "45-59", ">=60", "16-29.Male", "30-44.Male", "45-59.Male", ">=60.Male", "16-29.Female", "30-44.Female", "45-59.Female", ">=60.Female", "Sweden", "Europe", "Outside Europe", "<=9 years", "10-12 years", ">=13 years", "Manual and field trades", "Service and support", "Expertise and leadership", "<=2,500", "(2,500, 3,500]", "(3,500, 4,500]", ">4,500", "Currently married", "Never married", "Other", "living_alone_yes", "living_alone_no", "personal_support_yes", "personal_support_no", "SPHC 2002", "SPHC 2006", "SPHC 2010", "Stockholm County" )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>%
  mutate( subgroup = factor( subgroup, levels = desired_order ) ) %>%
  arrange( subgroup )

fluidity_cc_prop_summary[ 4,1 ] <- "Other"

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Sexual identityᵇ", .before = 1 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Sex", .before = 6 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Age group", .before = 9 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Male", .before = 14 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Female", .before = 19 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Country of birth", .before = 24 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Education years", .before = 28 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Occupationᵉ", .before = 32 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Income (100 kr/yr)ᶠ", .before = 36 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Marital statusʰ", .before = 41 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Living alone", .before = 45 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Personal support", .before = 48 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_row( subgroup = "Cohort yearⁱ", .before = 51 )

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "16-29" ] <- "16–29 yrsᶜ"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "30-44" ] <- "30–44 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "45-59" ] <- "45–59 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == ">=60" ] <- "\u2265 60 yrs"

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "16-29.Male" ] <- "16–29 yrsᵇ"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "30-44.Male" ] <- "30–44 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "45-59.Male" ] <- "45–59 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == ">=60.Male" ] <- "\u2265 60 yrs"

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "16-29.Female" ] <- "16–29 yrsᵇ"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "30-44.Female" ] <- "30–44 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "45-59.Female" ] <- "45–59 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == ">=60.Female" ] <- "\u2265 60 yrs"

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "<=9 years" ] <- "\u2264 9 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "10-12 years" ] <- "10–12 yrs"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == ">=13 years" ] <- "\u2265 13 yrs"

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "Europe" ] <- "Europeᵈ"

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "<=2,500" ] <- "\u2264 2,500"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == ">4,500" ] <- "> 4,500"

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "living_alone_no" ] <- "No"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "living_alone_yes" ] <- "Yes"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "personal_support_no" ] <- "No"
fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "personal_support_yes" ] <- "Yes"

fluidity_cc_prop_summary$subgroup <- ifelse( ( is.na( fluidity_cc_prop_summary$changed_point_estimate_2010_2021 ) &
                                                 is.na( fluidity_cc_prop_summary$changed_point_estimate_2010 ) ) | 
                                      fluidity_cc_prop_summary$subgroup == "Stockholm County", 
                                    fluidity_cc_prop_summary$subgroup,
                                    paste0( "   ", fluidity_cc_prop_summary$subgroup ) )

fluidity_cc_prop_summary$subgroup[ fluidity_cc_prop_summary$subgroup == "Stockholm County" ] <- "Stockholm Countyᵍ"
colnames( fluidity_cc_prop_summary )[ colnames( fluidity_cc_prop_summary ) == "subgroup" ] <- "Subgroup"


fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_column( "SPHC-F 2010-2021" = paste0(
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_point_estimate_2010_2021*100 ), " (", 
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_lower_ci_2010_2021*100 ), ", ", 
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_upper_ci_2010_2021*100 ), ")" ),
    .before = 3 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 8 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_column( "SPHC 2010" = paste0(
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_point_estimate_2010*100 ), " (", 
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_lower_ci_2010*100 ), ", ", 
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_upper_ci_2010*100 ), ")" ),
    .before = 9 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 14 )

fluidity_cc_prop_summary <- fluidity_cc_prop_summary %>% 
  add_column( "SPHC 2014" = paste0(
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_point_estimate_2014*100 ), " (", 
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_lower_ci_2014*100 ), ", ", 
    sprintf( "%.1f", fluidity_cc_prop_summary$changed_upper_ci_2014*100 ), ")"  ),
    .before = 15 )

fluidity_cc_prop_summary$`SPHC-F 2010-2021` <- ifelse( 
  is.na( fluidity_cc_prop_summary$changed_point_estimate_2010_2021 ) &
    is.na( fluidity_cc_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_cc_prop_summary$`SPHC-F 2010-2021` )
fluidity_cc_prop_summary$`SPHC-F 2010-2021`[ fluidity_cc_prop_summary$`SPHC-F 2010-2021` == "NA (NA, NA)" ] <- "\u2013"

fluidity_cc_prop_summary$`SPHC 2010` <- ifelse( 
  is.na( fluidity_cc_prop_summary$changed_point_estimate_2010_2021 ) &
    is.na( fluidity_cc_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_cc_prop_summary$`SPHC 2010` )
fluidity_cc_prop_summary$`SPHC 2010`[ fluidity_cc_prop_summary$`SPHC 2010` == "NA (NA, NA)" ] <- "\u2013"

fluidity_cc_prop_summary$`SPHC 2014` <- ifelse( 
  is.na( fluidity_cc_prop_summary$changed_point_estimate_2010_2021 ) &
    is.na( fluidity_cc_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_cc_prop_summary$`SPHC 2014` )
fluidity_cc_prop_summary$`SPHC 2014`[ fluidity_cc_prop_summary$`SPHC 2014` == "NA (NA, NA)" ] <- "\u2013"

fluidity_cc_prop_summary$sample_size_2010_2021 <- prettyNum( fluidity_cc_prop_summary$sample_size_2010_2021, big.mark = ",", preserve.width = "none" )

fluidity_cc_prop_summary$sample_size_2010_2021 <- ifelse(
  is.na( fluidity_cc_prop_summary$changed_point_estimate_2010_2021 ) &
    is.na( fluidity_cc_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_cc_prop_summary$sample_size_2010_2021
)
fluidity_cc_prop_summary$sample_size_2010_2021[ fluidity_cc_prop_summary$sample_size_2010_2021 == "NA" ] <- "\u2013"

fluidity_cc_prop_summary$sample_size_2010 <- ifelse(
  is.na( fluidity_cc_prop_summary$changed_point_estimate_2010_2021 ) &
    is.na( fluidity_cc_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_cc_prop_summary$sample_size_2010
)
fluidity_cc_prop_summary$sample_size_2010[ is.na( fluidity_cc_prop_summary$sample_size_2010 ) ] <- "\u2013"

fluidity_cc_prop_summary$sample_size_2014 <- ifelse(
  is.na( fluidity_cc_prop_summary$changed_point_estimate_2010_2021 ) &
    is.na( fluidity_cc_prop_summary$changed_point_estimate_2010 ), "",
  fluidity_cc_prop_summary$sample_size_2014
)
fluidity_cc_prop_summary$sample_size_2014[ is.na( fluidity_cc_prop_summary$sample_size_2014 ) ] <- "\u2013"


fluidity_cc_prop_summary_updated <- fluidity_cc_prop_summary %>%
  select( 1:4, 8, 9, 13, 14, 15, 19, everything() )

fluidity_cc_prop_summary_updated <- fluidity_cc_prop_summary_updated %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 7 ) %>%
  add_column( temp4 = " ", .before = 10 ) %>%
  add_column( temp5 = " ", .before = 12 ) %>%
  add_column( temp6 = " ", .before = 15 )

names( fluidity_cc_prop_summary_updated )[ names( fluidity_cc_prop_summary_updated ) %in% c( "temp1", "temp2", "temp3", "temp4", "temp5", "temp6" ) ] <- ""

colnames( fluidity_cc_prop_summary_updated )[ colnames( fluidity_cc_prop_summary_updated ) == "SPHC-F 2010-2021" ] <- ""
colnames( fluidity_cc_prop_summary_updated )[ colnames( fluidity_cc_prop_summary_updated ) == "SPHC 2010" ] <- ""
colnames( fluidity_cc_prop_summary_updated )[ colnames( fluidity_cc_prop_summary_updated ) == "SPHC 2014" ] <- ""

colnames( fluidity_cc_prop_summary_updated )[ colnames( fluidity_cc_prop_summary_updated ) == "sample_size_2010_2021" ] <- ""
colnames( fluidity_cc_prop_summary_updated )[ colnames( fluidity_cc_prop_summary_updated ) == "sample_size_2010" ] <- ""
colnames( fluidity_cc_prop_summary_updated )[ colnames( fluidity_cc_prop_summary_updated ) == "sample_size_2014" ] <- ""
```

#### 4.2. Plotting
##### 4.2.1. Part 1
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

fluidity_cc_prop_summary_updated_part_1 <- fluidity_cc_prop_summary_updated[ c( 1:13, 24:40, 55 ), ]

p_prop_cc_fluidity <- forest(
  fluidity_cc_prop_summary_updated_part_1[ , c( 1:16 ) ],
  
  est = list( fluidity_cc_prop_summary_updated_part_1$changed_point_estimate_2010_2021*100,
              fluidity_cc_prop_summary_updated_part_1$changed_point_estimate_2010*100,
              fluidity_cc_prop_summary_updated_part_1$changed_point_estimate_2014*100
  ),
  
  lower = list( fluidity_cc_prop_summary_updated_part_1$changed_lower_ci_2010_2021*100,
                fluidity_cc_prop_summary_updated_part_1$changed_lower_ci_2010*100,
                fluidity_cc_prop_summary_updated_part_1$changed_lower_ci_2014*100
  ),
  
  upper = list( fluidity_cc_prop_summary_updated_part_1$changed_upper_ci_2010_2021*100,
                fluidity_cc_prop_summary_updated_part_1$changed_upper_ci_2010*100,
                fluidity_cc_prop_summary_updated_part_1$changed_upper_ci_2014*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( fluidity_cc_prop_summary_updated_part_1 ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( fluidity_cc_prop_summary_2010_2021[ fluidity_cc_prop_summary_2010_2021$subgroup == "Stockholm County", ]$changed_point_estimate_2010_2021*100,
              fluidity_cc_prop_summary_2010[ fluidity_cc_prop_summary_2010$subgroup == "Stockholm County", ]$changed_point_estimate_2010*100,
              fluidity_cc_prop_summary_2014[ fluidity_cc_prop_summary_2014$subgroup == "Stockholm County", ]$changed_point_estimate_2014*100 ),
  
  xlim = list( c( 0, 80 ), c( 0, 80 ), c( 0, 60 ) ),
  ticks_at = list( c( 0, 20, 40, 60, 80 ), c( 0, 20, 40, 60, 80 ), c( 0, 20, 40, 60 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_prop_cc_fluidity <- edit_plot(
  p_prop_cc_fluidity,
  row = c( 1, 6, 9, 14, 18, 22, 26, 31 ),
  gp = gpar(fontface = "bold")
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- insert_text(
  p_prop_cc_fluidity,
  text = "SPHC-F 2010-2021",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SPHC 2010",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SPHC 2014",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- edit_plot( p_prop_cc_fluidity,
                                row = c( 1, 6, 9, 14, 18, 22, 26, 31 ), 
                                which = "background",
                                gp = gpar( fill = "white" )
)

p_prop_cc_fluidity <- edit_plot( p_prop_cc_fluidity,
                                row = c( 2:5, 7, 8, 10:13, 15:17, 19:21, 23:25, 27:30 ), 
                                which = "background",
                                gp = gpar( fill = "#eff3f2" )
)

plot( p_prop_cc_fluidity )
```

##### 4.2.2. Part 2
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

fluidity_cc_prop_summary_updated_part_2 <- fluidity_cc_prop_summary_updated[ c( 41:55 ), ]

p_prop_cc_fluidity <- forest(
  fluidity_cc_prop_summary_updated_part_2[ , c( 1:16 ) ],
  
  est = list( fluidity_cc_prop_summary_updated_part_2$changed_point_estimate_2010_2021*100,
              fluidity_cc_prop_summary_updated_part_2$changed_point_estimate_2010*100,
              fluidity_cc_prop_summary_updated_part_2$changed_point_estimate_2014*100
  ),
  
  lower = list( fluidity_cc_prop_summary_updated_part_2$changed_lower_ci_2010_2021*100,
                fluidity_cc_prop_summary_updated_part_2$changed_lower_ci_2010*100,
                fluidity_cc_prop_summary_updated_part_2$changed_lower_ci_2014*100
  ),
  
  upper = list( fluidity_cc_prop_summary_updated_part_2$changed_upper_ci_2010_2021*100,
                fluidity_cc_prop_summary_updated_part_2$changed_upper_ci_2010*100,
                fluidity_cc_prop_summary_updated_part_2$changed_upper_ci_2014*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( fluidity_cc_prop_summary_updated_part_2 ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( fluidity_cc_prop_summary_2010_2021[ fluidity_cc_prop_summary_2010_2021$subgroup == "Stockholm County", ]$changed_point_estimate_2010_2021*100,
              fluidity_cc_prop_summary_2010[ fluidity_cc_prop_summary_2010$subgroup == "Stockholm County", ]$changed_point_estimate_2010*100,
              fluidity_cc_prop_summary_2014[ fluidity_cc_prop_summary_2014$subgroup == "Stockholm County", ]$changed_point_estimate_2014*100 ),
  
  xlim = list( c( 5, 25 ), c( 5, 25 ), c( 5, 15 ) ),
  ticks_at = list( c( 5, 10, 15, 20, 25 ), c( 5, 10, 15, 20, 25 ), c( 5, 10, 15 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_prop_cc_fluidity <- edit_plot(
  p_prop_cc_fluidity,
  row = c( 1, 5, 8, 11, 15 ),
  gp = gpar(fontface = "bold")
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- insert_text(
  p_prop_cc_fluidity,
  text = "SPHC-F 2010-2021",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SPHC 2010",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SPHC 2014",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- edit_plot( p_prop_cc_fluidity,
                                row = c( 1, 5, 8, 11, 15 ), 
                                which = "background",
                                gp = gpar( fill = "white" )
)

p_prop_cc_fluidity <- edit_plot( p_prop_cc_fluidity,
                                row = c( 2:4, 6, 7, 9, 10, 12:14 ), 
                                which = "background",
                                gp = gpar( fill = "#eff3f2" )
)

plot( p_prop_cc_fluidity )
```

##### 4.2.3. Part 3
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ), 
  base_family = "Arial",
  ci_col = "red",
  refline_lty = "dotted",
  refline_lwd = 1,
  refline_col = "steelblue",
  vertline_lty = "dashed",
  vertline_lwd = 1,
  vertline_col = "steelblue",
  summary_col = "#4575b4",
  summary_fill = "#4575b4"
)

fluidity_cc_prop_summary_updated_part_3 <- fluidity_cc_prop_summary_updated[ c( 14:23, 55 ), ]
fluidity_cc_prop_summary_updated_part_3$Subgroup[ fluidity_cc_prop_summary_updated_part_3$Subgroup == "Stockholm Countyᵍ" ] <- "Stockholm Countyᶜ"

p_prop_cc_fluidity <- forest(
  fluidity_cc_prop_summary_updated_part_3[ , c( 1:16 ) ],
  
  est = list( fluidity_cc_prop_summary_updated_part_3$changed_point_estimate_2010_2021*100,
              fluidity_cc_prop_summary_updated_part_3$changed_point_estimate_2010*100,
              fluidity_cc_prop_summary_updated_part_3$changed_point_estimate_2014*100
  ),
  
  lower = list( fluidity_cc_prop_summary_updated_part_3$changed_lower_ci_2010_2021*100,
                fluidity_cc_prop_summary_updated_part_3$changed_lower_ci_2010*100,
                fluidity_cc_prop_summary_updated_part_3$changed_lower_ci_2014*100
  ),
  
  upper = list( fluidity_cc_prop_summary_updated_part_3$changed_upper_ci_2010_2021*100,
                fluidity_cc_prop_summary_updated_part_3$changed_upper_ci_2010*100,
                fluidity_cc_prop_summary_updated_part_3$changed_upper_ci_2014*100
  ),
  
  ci_column = c( 3, 8, 13 ),
  is_summary = c( rep( FALSE, nrow( fluidity_cc_prop_summary_updated_part_3 ) - 1 ), TRUE ),
  sizes = 0.4,
  
  ref_line = c( fluidity_cc_prop_summary_2010_2021[ fluidity_cc_prop_summary_2010_2021$subgroup == "Stockholm County", ]$changed_point_estimate_2010_2021*100,
              fluidity_cc_prop_summary_2010[ fluidity_cc_prop_summary_2010$subgroup == "Stockholm County", ]$changed_point_estimate_2010*100,
              fluidity_cc_prop_summary_2014[ fluidity_cc_prop_summary_2014$subgroup == "Stockholm County", ]$changed_point_estimate_2014*100 ),
  
  xlim = list( c( 5, 25 ), c( 5, 25 ), c( 0, 15 ) ),
  ticks_at = list( c( 5, 10, 15, 20, 25 ), c( 5, 10, 15, 20, 25 ), c( 0, 5, 10, 15 ) ),
  
  xlab = "Proportion (%) (95% CI)",
  theme = tm
)

p_prop_cc_fluidity <- edit_plot(
  p_prop_cc_fluidity,
  row = c( 1, 6, 11 ),
  gp = gpar(fontface = "bold")
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 3:4,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SSᵃ",
  col = 16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- insert_text(
  p_prop_cc_fluidity,
  text = "SPHC-F 2010-2021",
  col = 3:6,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SPHC 2010",
  col = 8:11,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 8:9,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "SPHC 2014",
  col = 13:16,
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_text(
  p_prop_cc_fluidity,
  text = "Proportion (%) (95% CI)",
  col = 13:14,
  row = 2,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 3:6,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 8:11,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- add_border(
  p_prop_cc_fluidity,
  part = "header",
  row = 1,
  where = "bottom",
  col = 13:16,
  gp = gpar(lwd = 1)
)

p_prop_cc_fluidity <- edit_plot( p_prop_cc_fluidity,
                                row = c( 1, 6, 11 ), 
                                which = "background",
                                gp = gpar( fill = "white" )
)

p_prop_cc_fluidity <- edit_plot( p_prop_cc_fluidity,
                                row = c( 2:5, 7:10 ), 
                                which = "background",
                                gp = gpar( fill = "#eff3f2" )
)

plot( p_prop_cc_fluidity )
```

### 5. Plots for Relation between Changes in Sexual Identity and Demographic Factors
#### 5.1. Complete-case analysis
##### 5.1.1. Prepare dataset for plotting
```{r}
fluidity_cc_rr_2010 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_cc_rr_2010.xlsx")
fluidity_cc_rr_2014 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_cc_rr_2014.xlsx")
fluidity_cc_rr_SPHC_F_2010_2021 <- read_xlsx("/Users/guoqiang.zhang/Documents/Karolinska Institutet/Research Projects/Trends and Fluidity of Sexual Identity/Sexual_identity_in_Stockholm_County/fluidity_cc_rr_SPHC-F_2010-2021.xlsx")

colnames(fluidity_cc_rr_2010)[-1] <- paste0(colnames(fluidity_cc_rr_2010)[-1], "_2010")
colnames(fluidity_cc_rr_2014)[-1] <- paste0(colnames(fluidity_cc_rr_2014)[-1], "_2014")
colnames(fluidity_cc_rr_SPHC_F_2010_2021)[-1] <- paste0(colnames(fluidity_cc_rr_SPHC_F_2010_2021)[-1], "_2010_2021")

# to make it easier to combine across datasets
# a note on these changes will be added on the graph later
fluidity_cc_rr_2010$Exposure[ fluidity_cc_rr_2010$Exposure == "age_exp18-29" ] <- "age_exp16-29"
fluidity_cc_rr_2010$Exposure[ fluidity_cc_rr_2010$Exposure == "age_exp18-29_Male" ] <- "age_exp16-29_Male"
fluidity_cc_rr_2010$Exposure[ fluidity_cc_rr_2010$Exposure == "age_exp18-29_Female" ] <- "age_exp16-29_Female"

fluidity_cc_rr_SPHC_F_2010_2021$Exposure[ fluidity_cc_rr_SPHC_F_2010_2021$Exposure == "age_exp<=29" ] <- "age_exp16-29"
fluidity_cc_rr_SPHC_F_2010_2021$Exposure[ fluidity_cc_rr_SPHC_F_2010_2021$Exposure == "age_exp<=29_Male" ] <- "age_exp16-29_Male"
fluidity_cc_rr_SPHC_F_2010_2021$Exposure[ fluidity_cc_rr_SPHC_F_2010_2021$Exposure == "age_exp<=29_Female" ] <- "age_exp16-29_Female"

fluidity_cc_rr_2010$Exposure[ fluidity_cc_rr_2010$Exposure == "sexual_identity_2010_expHomosexual" ] <- "Homosexual"
fluidity_cc_rr_2010$Exposure[ fluidity_cc_rr_2010$Exposure == "sexual_identity_2010_expBisexual" ] <- "Bisexual"
fluidity_cc_rr_2010$Exposure[ fluidity_cc_rr_2010$Exposure == "sexual_identity_2010_expOther" ] <- "Other"

fluidity_cc_rr_2014$Exposure[ fluidity_cc_rr_2014$Exposure == "sexual_identity_2014_expHomosexual" ] <- "Homosexual"
fluidity_cc_rr_2014$Exposure[ fluidity_cc_rr_2014$Exposure == "sexual_identity_2014_expBisexual" ] <- "Bisexual"
fluidity_cc_rr_2014$Exposure[ fluidity_cc_rr_2014$Exposure == "sexual_identity_2014_expOther" ] <- "Other"

fluidity_cc_rr_SPHC_F_2010_2021$Exposure[ fluidity_cc_rr_SPHC_F_2010_2021$Exposure == "sexual_identity_2010_expHomosexual" ] <- "Homosexual"
fluidity_cc_rr_SPHC_F_2010_2021$Exposure[ fluidity_cc_rr_SPHC_F_2010_2021$Exposure == "sexual_identity_2010_expBisexual" ] <- "Bisexual"
fluidity_cc_rr_SPHC_F_2010_2021$Exposure[ fluidity_cc_rr_SPHC_F_2010_2021$Exposure == "sexual_identity_2010_expOther" ] <- "Other"

# merge datasets
fluidity_cc_rr <- fluidity_cc_rr_SPHC_F_2010_2021 %>%
  full_join( fluidity_cc_rr_2010, by = "Exposure" ) %>%
  full_join( fluidity_cc_rr_2014, by = "Exposure" )

# modify table format
desired_order <- c( "Homosexual", "Bisexual", "Other", "sex_expFemale", "age_exp16-29", "age_exp30-44", "age_exp>=60", "age_exp16-29_Male", "age_exp30-44_Male", "age_exp>=60_Male", "age_exp16-29_Female", "age_exp30-44_Female", "age_exp>=60_Female", "country_of_birth_expEurope", "country_of_birth_expOutside Europe", "education_exp<=9 years", "education_exp10-12 years", "income_exp<=2,500", "income_exp(2,500, 3,500]", "income_exp(3,500, 4,500]", "marital_status_expNever married", "marital_status_expOther", "living_status_expyes", "personal_support_expno", "year_expSPHC 2006", "year_expSPHC 2010" )

fluidity_cc_rr <- fluidity_cc_rr %>%
  mutate( Exposure = factor( Exposure, levels = desired_order ) ) %>%
  arrange( Exposure )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Sexual identityⁱ", .before = 1 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Sex", .before = 5 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Age group", .before = 7 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Male", .before = 11 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Female", .before = 15 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Country of birth", .before = 19 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Education years", .before = 22 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Income (100 kr/yr)ᶠ", .before = 25 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Marital statusᵍ", .before = 29 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Living alone", .before = 32 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Personal support", .before = 34 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = "Cohort yearʰ", .before = 36 )

fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "Homosexual" ] <- paste0( "   ", "Homosexual\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "Bisexual" ] <- paste0( "   ", "Bisexual\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "Other" ] <- paste0( "   ", "Other\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "year_expSPHC 2006" ] <- paste0( "   ", "SPHC 2006\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "year_expSPHC 2010" ] <- paste0( "   ", "SPHC 2010\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "sex_expFemale" ] <- paste0( "   ", "Female\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp16-29" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp30-44" ] <- paste0( "   ", "30–44 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp>=60" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp16-29_Male" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp30-44_Male" ] <- paste0( "   ", "30–44 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp>=60_Male" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp16-29_Female" ] <- paste0( "   ", "16–29 yrsᵈ\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp30-44_Female" ] <- paste0( "   ", "30–44 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "age_exp>=60_Female" ] <- paste0( "   ", "\u2265 60 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "country_of_birth_expEurope" ] <- paste0( "   ", "Europeᵉ\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "country_of_birth_expOutside Europe" ] <- paste0( "   ", "Outside Europe\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "education_exp<=9 years" ] <- paste0( "   ", "\u2264 9 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "education_exp10-12 years" ] <- paste0( "   ", "10–12 yrs\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "income_exp<=2,500" ] <- paste0( "   ", "\u2264 2,500\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "income_exp(2,500, 3,500]" ] <- paste0( "   ", "(2,500, 3,500]\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "income_exp(3,500, 4,500]" ] <- paste0( "   ", "(3,500, 4,500]\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "marital_status_expNever married" ] <- paste0( "   ", "Never married\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "marital_status_expOther" ] <- paste0( "   ", "Other\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "living_status_expyes" ] <- paste0( "   ", "Yes\n\n" )
fluidity_cc_rr$Exposure[ fluidity_cc_rr$Exposure == "personal_support_expno" ] <- paste0( "   ", "No\n\n" )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2010_2021_crude" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_crude_2010_2021 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_crude_2010_2021 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_crude_2010_2021 ), ")" ),
    .before = 2 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2010_2021_model_1" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_model_1_2010_2021 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_model_1_2010_2021 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_model_1_2010_2021 ), ")" ),
    .before = 3 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2010_2021_model_2" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_model_2_2010_2021 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_model_2_2010_2021 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_model_2_2010_2021 ), ")" ),
    .before = 4 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2010_crude" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_crude_2010 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_crude_2010 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_crude_2010 ), ")" ),
    .before = 5 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2010_model_1" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_model_1_2010 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_model_1_2010 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_model_1_2010 ), ")" ),
    .before = 6 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2010_model_2" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_model_2_2010 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_model_2_2010 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_model_2_2010 ), ")" ),
    .before = 7 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2014_crude" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_crude_2014 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_crude_2014 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_crude_2014 ), ")" ),
    .before = 8 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2014_model_1" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_model_1_2014 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_model_1_2014 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_model_1_2014 ), ")" ),
    .before = 9 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_2014_model_2" = paste0(
    sprintf( "%.2f", fluidity_cc_rr$point_estimate_model_2_2014 ), " (", 
    sprintf( "%.2f", fluidity_cc_rr$lower_ci_model_2_2014 ), ", ", 
    sprintf( "%.2f", fluidity_cc_rr$upper_ci_model_2_2014 ), ")" ),
    .before = 10 )


fluidity_cc_rr$Sexual_fluidity_2010_crude <- ifelse( !is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ) & is.na( fluidity_cc_rr$point_estimate_crude_2010 ), "\u2013",
                                                            fluidity_cc_rr$Sexual_fluidity_2010_crude )

fluidity_cc_rr$Sexual_fluidity_2010_model_1 <- ifelse( !is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ) & is.na( fluidity_cc_rr$point_estimate_crude_2010 ), "\u2013",
                                                            fluidity_cc_rr$Sexual_fluidity_2010_model_1 )

fluidity_cc_rr$Sexual_fluidity_2010_model_2 <- ifelse( !is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ) & is.na( fluidity_cc_rr$point_estimate_crude_2010 ), "\u2013",
                                                            fluidity_cc_rr$Sexual_fluidity_2010_model_2 )

fluidity_cc_rr$Sexual_fluidity_2014_crude <- ifelse( !is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ) & is.na( fluidity_cc_rr$point_estimate_crude_2010 ), "\u2013",
                                                            fluidity_cc_rr$Sexual_fluidity_2014_crude )

fluidity_cc_rr$Sexual_fluidity_2014_model_1 <- ifelse( !is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ) & is.na( fluidity_cc_rr$point_estimate_crude_2010 ), "\u2013",
                                                            fluidity_cc_rr$Sexual_fluidity_2014_model_1 )

fluidity_cc_rr$Sexual_fluidity_2014_model_2 <- ifelse( !is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ) & is.na( fluidity_cc_rr$point_estimate_crude_2010 ), "\u2013",
                                                            fluidity_cc_rr$Sexual_fluidity_2014_model_2 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_crude" = paste( fluidity_cc_rr$Sexual_fluidity_2010_2021_crude,
                                               fluidity_cc_rr$Sexual_fluidity_2010_crude,
                                               fluidity_cc_rr$Sexual_fluidity_2014_crude,
                                               sep = "\n" ),
              .before = 2 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_model_1" = paste( fluidity_cc_rr$Sexual_fluidity_2010_2021_model_1,
                                                 fluidity_cc_rr$Sexual_fluidity_2010_model_1,
                                                 fluidity_cc_rr$Sexual_fluidity_2014_model_1,
                                                 sep = "\n" ),
              .before = 3 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( "Sexual_fluidity_model_2" = paste( fluidity_cc_rr$Sexual_fluidity_2010_2021_model_2,
                                                 fluidity_cc_rr$Sexual_fluidity_2010_model_2,
                                                 fluidity_cc_rr$Sexual_fluidity_2014_model_2,
                                                 sep = "\n" ),
              .before = 4 )


fluidity_cc_rr$Sexual_fluidity_crude <- ifelse( is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ), "",
                                                       fluidity_cc_rr$Sexual_fluidity_crude )

fluidity_cc_rr$Sexual_fluidity_model_1 <- ifelse( is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ), "",
                                                       fluidity_cc_rr$Sexual_fluidity_model_1 )

fluidity_cc_rr$Sexual_fluidity_model_2 <- ifelse( is.na( fluidity_cc_rr$point_estimate_crude_2010_2021 ), "",
                                                       fluidity_cc_rr$Sexual_fluidity_model_2 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "Heterosexual" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 2 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "Male" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 7 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 12 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 17 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "45–59 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 22 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "Sweden" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 25 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "\u2265 13 yrs" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 31 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "> 4,500" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 36 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "Currently married" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 38 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "No" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 43 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "Yes" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 45 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_row( Exposure = paste0( "   ", "SPHC 2002" ), 
           Sexual_fluidity_crude = "Reference",
           Sexual_fluidity_model_1 = "Reference",
           Sexual_fluidity_model_2 = "Reference",
           .before = 48 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( ` ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 2 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( `  ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 4 )

fluidity_cc_rr <- fluidity_cc_rr %>% 
  add_column( `   ` = paste( rep( " ", 20 ) , collapse = " " ), .before = 6 )

fluidity_cc_rr <- fluidity_cc_rr %>%
  add_column( temp1 = " ", .before = 2 ) %>%
  add_column( temp2 = " ", .before = 5 ) %>%
  add_column( temp3 = " ", .before = 8 )

colnames( fluidity_cc_rr )[1] <- "Demographic Factor"

names( fluidity_cc_rr )[ names( fluidity_cc_rr ) %in% c( "temp1", "temp2", "temp3", "Sexual_fluidity_crude", "Sexual_fluidity_model_1", "Sexual_fluidity_model_2" ) ] <- ""
```

##### 5.1.2. Plotting
###### 5.1.2.1. Part 1
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-F 2010-2021", "SPHC 2010", "SPHC 2014" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

fluidity_cc_rr_part_1 <- fluidity_cc_rr[ -c( 1:5, 14:23, 32:50 ), ]

p_cc_pr_poisson_sexual_fluidity <- forest(
  fluidity_cc_rr_part_1[ , c( 1:10 ) ],
  
  est = list( fluidity_cc_rr_part_1$point_estimate_crude_2010_2021,
              fluidity_cc_rr_part_1$point_estimate_model_1_2010_2021,
              fluidity_cc_rr_part_1$point_estimate_model_2_2010_2021,
              
              fluidity_cc_rr_part_1$point_estimate_crude_2010,
              fluidity_cc_rr_part_1$point_estimate_model_1_2010,
              fluidity_cc_rr_part_1$point_estimate_model_2_2010,
              
              fluidity_cc_rr_part_1$point_estimate_crude_2014,
              fluidity_cc_rr_part_1$point_estimate_model_1_2014,
              fluidity_cc_rr_part_1$point_estimate_model_2_2014
  ),
  
  lower = list( fluidity_cc_rr_part_1$lower_ci_crude_2010_2021,
                fluidity_cc_rr_part_1$lower_ci_model_1_2010_2021,
                fluidity_cc_rr_part_1$lower_ci_model_2_2010_2021,
                
                fluidity_cc_rr_part_1$lower_ci_crude_2010,
                fluidity_cc_rr_part_1$lower_ci_model_1_2010,
                fluidity_cc_rr_part_1$lower_ci_model_2_2010,
                
                fluidity_cc_rr_part_1$lower_ci_crude_2014,
                fluidity_cc_rr_part_1$lower_ci_model_1_2014,
                fluidity_cc_rr_part_1$lower_ci_model_2_2014
  ),
  
  upper = list( fluidity_cc_rr_part_1$upper_ci_crude_2010_2021,
                fluidity_cc_rr_part_1$upper_ci_model_1_2010_2021,
                fluidity_cc_rr_part_1$upper_ci_model_2_2010_2021,
                
                fluidity_cc_rr_part_1$upper_ci_crude_2010,
                fluidity_cc_rr_part_1$upper_ci_model_1_2010,
                fluidity_cc_rr_part_1$upper_ci_model_2_2010,
                
                fluidity_cc_rr_part_1$upper_ci_crude_2014,
                fluidity_cc_rr_part_1$upper_ci_model_1_2014,
                fluidity_cc_rr_part_1$upper_ci_model_2_2014
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Risk Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1, 4, 9, 13 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Crude Risk Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 1, Risk Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 2, Risk Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- insert_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Changes in Sexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1, 4, 9, 13 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 2, 3, 5:8, 10:12, 14:16 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_fluidity <- add_border(
  p_cc_pr_poisson_sexual_fluidity,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_fluidity )
```

###### 5.1.2.2. Part 2
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-F 2010-2021", "SPHC 2010", "SPHC 2014" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

fluidity_cc_rr_part_2 <- fluidity_cc_rr[ -c( 1:31 ), ]

p_cc_pr_poisson_sexual_fluidity <- forest(
  fluidity_cc_rr_part_2[ , c( 1:10 ) ],
  
  est = list( fluidity_cc_rr_part_2$point_estimate_crude_2010_2021,
              fluidity_cc_rr_part_2$point_estimate_model_1_2010_2021,
              fluidity_cc_rr_part_2$point_estimate_model_2_2010_2021,
              
              fluidity_cc_rr_part_2$point_estimate_crude_2010,
              fluidity_cc_rr_part_2$point_estimate_model_1_2010,
              fluidity_cc_rr_part_2$point_estimate_model_2_2010,
              
              fluidity_cc_rr_part_2$point_estimate_crude_2014,
              fluidity_cc_rr_part_2$point_estimate_model_1_2014,
              fluidity_cc_rr_part_2$point_estimate_model_2_2014
  ),
  
  lower = list( fluidity_cc_rr_part_2$lower_ci_crude_2010_2021,
                fluidity_cc_rr_part_2$lower_ci_model_1_2010_2021,
                fluidity_cc_rr_part_2$lower_ci_model_2_2010_2021,
                
                fluidity_cc_rr_part_2$lower_ci_crude_2010,
                fluidity_cc_rr_part_2$lower_ci_model_1_2010,
                fluidity_cc_rr_part_2$lower_ci_model_2_2010,
                
                fluidity_cc_rr_part_2$lower_ci_crude_2014,
                fluidity_cc_rr_part_2$lower_ci_model_1_2014,
                fluidity_cc_rr_part_2$lower_ci_model_2_2014
  ),
  
  upper = list( fluidity_cc_rr_part_2$upper_ci_crude_2010_2021,
                fluidity_cc_rr_part_2$upper_ci_model_1_2010_2021,
                fluidity_cc_rr_part_2$upper_ci_model_2_2010_2021,
                
                fluidity_cc_rr_part_2$upper_ci_crude_2010,
                fluidity_cc_rr_part_2$upper_ci_model_1_2010,
                fluidity_cc_rr_part_2$upper_ci_model_2_2010,
                
                fluidity_cc_rr_part_2$upper_ci_crude_2014,
                fluidity_cc_rr_part_2$upper_ci_model_1_2014,
                fluidity_cc_rr_part_2$upper_ci_model_2_2014
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Risk Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6, 10, 13, 16 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Crude Risk Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 1, Risk Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 2, Risk Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- insert_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Changes in Sexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6, 10, 13, 16 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 2:5, 7:9, 11, 12, 14, 15, 17:19 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_fluidity <- add_border(
  p_cc_pr_poisson_sexual_fluidity,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_fluidity )
```

###### 5.1.2.3. Part 3
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-F 2010-2021", "SPHC 2010", "SPHC 2014" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

fluidity_cc_rr_part_3 <- fluidity_cc_rr[ c( 1:5 ), ]

p_cc_pr_poisson_sexual_fluidity <- forest(
  fluidity_cc_rr_part_3[ , c( 1:10 ) ],
  
  est = list( fluidity_cc_rr_part_3$point_estimate_crude_2010_2021,
              fluidity_cc_rr_part_3$point_estimate_model_1_2010_2021,
              fluidity_cc_rr_part_3$point_estimate_model_2_2010_2021,
              
              fluidity_cc_rr_part_3$point_estimate_crude_2010,
              fluidity_cc_rr_part_3$point_estimate_model_1_2010,
              fluidity_cc_rr_part_3$point_estimate_model_2_2010,
              
              fluidity_cc_rr_part_3$point_estimate_crude_2014,
              fluidity_cc_rr_part_3$point_estimate_model_1_2014,
              fluidity_cc_rr_part_3$point_estimate_model_2_2014
  ),
  
  lower = list( fluidity_cc_rr_part_3$lower_ci_crude_2010_2021,
                fluidity_cc_rr_part_3$lower_ci_model_1_2010_2021,
                fluidity_cc_rr_part_3$lower_ci_model_2_2010_2021,
                
                fluidity_cc_rr_part_3$lower_ci_crude_2010,
                fluidity_cc_rr_part_3$lower_ci_model_1_2010,
                fluidity_cc_rr_part_3$lower_ci_model_2_2010,
                
                fluidity_cc_rr_part_3$lower_ci_crude_2014,
                fluidity_cc_rr_part_3$lower_ci_model_1_2014,
                fluidity_cc_rr_part_3$lower_ci_model_2_2014
  ),
  
  upper = list( fluidity_cc_rr_part_3$upper_ci_crude_2010_2021,
                fluidity_cc_rr_part_3$upper_ci_model_1_2010_2021,
                fluidity_cc_rr_part_3$upper_ci_model_2_2010_2021,
                
                fluidity_cc_rr_part_3$upper_ci_crude_2010,
                fluidity_cc_rr_part_3$upper_ci_model_1_2010,
                fluidity_cc_rr_part_3$upper_ci_model_2_2010,
                
                fluidity_cc_rr_part_3$upper_ci_crude_2014,
                fluidity_cc_rr_part_3$upper_ci_model_1_2014,
                fluidity_cc_rr_part_3$upper_ci_model_2_2014
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 20 ),
  ticks_at = c( 0, 5, 10, 15, 20 ),
  
  xlab = "Risk Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Crude Risk Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 1, Risk Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 2, Risk Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- insert_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Changes in Sexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 2:5 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_fluidity <- add_border(
  p_cc_pr_poisson_sexual_fluidity,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_fluidity )
```

###### 5.1.2.4. Part 4 (age by sex)
```{r}
tm <- forest_theme(
  base_size = 10,
  colhead = list( fg_params = list( fontsize = 10 ) ),
  legend_value = c( "SPHC-F 2010-2021", "SPHC 2010", "SPHC 2014" ),
  legend_name = NULL,
  legend_position = "bottom",
  base_family = "Arial",
  refline_lty = "dashed",
  refline_lwd = 1,
  refline_col = "grey20"
)

fluidity_cc_rr_age_by_sex <- fluidity_cc_rr[ c( 14:23 ), ]

p_cc_pr_poisson_sexual_fluidity <- forest(
  fluidity_cc_rr_age_by_sex[ , c( 1:10 ) ],
  
  est = list( fluidity_cc_rr_age_by_sex$point_estimate_crude_2010_2021,
              fluidity_cc_rr_age_by_sex$point_estimate_model_1_2010_2021,
              fluidity_cc_rr_age_by_sex$point_estimate_model_2_2010_2021,
              
              fluidity_cc_rr_age_by_sex$point_estimate_crude_2010,
              fluidity_cc_rr_age_by_sex$point_estimate_model_1_2010,
              fluidity_cc_rr_age_by_sex$point_estimate_model_2_2010,
              
              fluidity_cc_rr_age_by_sex$point_estimate_crude_2014,
              fluidity_cc_rr_age_by_sex$point_estimate_model_1_2014,
              fluidity_cc_rr_age_by_sex$point_estimate_model_2_2014
  ),
  
  lower = list( fluidity_cc_rr_age_by_sex$lower_ci_crude_2010_2021,
                fluidity_cc_rr_age_by_sex$lower_ci_model_1_2010_2021,
                fluidity_cc_rr_age_by_sex$lower_ci_model_2_2010_2021,
                
                fluidity_cc_rr_age_by_sex$lower_ci_crude_2010,
                fluidity_cc_rr_age_by_sex$lower_ci_model_1_2010,
                fluidity_cc_rr_age_by_sex$lower_ci_model_2_2010,
                
                fluidity_cc_rr_age_by_sex$lower_ci_crude_2014,
                fluidity_cc_rr_age_by_sex$lower_ci_model_1_2014,
                fluidity_cc_rr_age_by_sex$lower_ci_model_2_2014
  ),
  
  upper = list( fluidity_cc_rr_age_by_sex$upper_ci_crude_2010_2021,
                fluidity_cc_rr_age_by_sex$upper_ci_model_1_2010_2021,
                fluidity_cc_rr_age_by_sex$upper_ci_model_2_2010_2021,
                
                fluidity_cc_rr_age_by_sex$upper_ci_crude_2010,
                fluidity_cc_rr_age_by_sex$upper_ci_model_1_2010,
                fluidity_cc_rr_age_by_sex$upper_ci_model_2_2010,
                
                fluidity_cc_rr_age_by_sex$upper_ci_crude_2014,
                fluidity_cc_rr_age_by_sex$upper_ci_model_1_2014,
                fluidity_cc_rr_age_by_sex$upper_ci_model_2_2014
  ),
  
  ci_column = c( 3, 6, 9 ),
  sizes = 0.4,
  
  ref_line = 1,
  
  xlim = c( 0, 4 ),
  ticks_at = c( 0, 1, 2, 3, 4 ),
  
  xlab = "Risk Ratio (95% CI)",
  nudge_y = 0.33,
  theme = tm
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6 ),
                                              col = 1,
                                              gp = gpar( fontface = "bold" ) 
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Crude Risk Ratio (95% CI)",
  col = c( 3:4 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 1, Risk Ratio (95% CI)ᵇ",
  col = c( 6:7 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- add_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Model 2, Risk Ratio (95% CI)ᶜ",
  col = c( 9:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- insert_text(
  p_cc_pr_poisson_sexual_fluidity,
  text = "Changes in Sexual Identityᵃ",
  col = c( 3:10 ),
  row = 1,
  part = "header",
  gp = gpar(
    fontface = "bold",
    fontsize = 10,
    fontfamily = "Arial"
  )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 1, 6 ), 
                                              which = "background",
                                              gp = gpar( fill = "white" )
)

p_cc_pr_poisson_sexual_fluidity <- edit_plot( p_cc_pr_poisson_sexual_fluidity,
                                              row = c( 2:5, 7:10 ), 
                                              which = "background",
                                              gp = gpar( fill = "#eff3f2" )
)

p_cc_pr_poisson_sexual_fluidity <- add_border(
  p_cc_pr_poisson_sexual_fluidity,
  part = "header",
  row = 2,
  col = c( 3:10 ),
  where = "top",
  gp = gpar(lwd = 1)
)

plot( p_cc_pr_poisson_sexual_fluidity )
```